custom_map_mode_initialize = {
    effect = {
        set_global_variable = {
            name = custom_map_mode
            value = flag:none
        }
        siro_e_map_barony = yes
    }
    is_valid = {
        has_global_variable = custom_map_mode
        NOT = { global_var:custom_map_mode = flag:none  }
    }
}

minorities_map = {
    effect = {
        if = {
            limit = {
                OR = {
                    NOT = { has_global_variable = custom_map_mode }
                    NOT = { global_var:custom_map_mode = flag:minorities_map }
                }
            }
            set_global_variable = {
                name = custom_map_mode_changing
                value = 1
            }
            set_global_variable = {
                name = custom_map_mode
                value = flag:minorities_map
            }
            every_barony = {
                if = {
                    limit = {
                        county = {
                            county_has_minority_faith_trigger = yes
                            county_has_minority_culture_trigger = no
                        }
                    }
                    set_color_from_title = title:d_sea_minorities_map_faith
                }
                else_if = {
                    limit = {
                        county = {
                            county_has_minority_faith_trigger = no
                            county_has_minority_culture_trigger = yes
                        }
                    }
                    set_color_from_title = title:d_sea_minorities_map_culture
                }
                else_if = {
                    limit = {
                        county = {
                            county_has_minority_faith_trigger = yes
                            county_has_minority_culture_trigger = yes
                        }
                    }
                    set_color_from_title = title:d_sea_minorities_map_culture_faith
                }
                else = {
                    set_color_from_title = title:d_siro_map_base
                }
            }
            remove_global_variable = custom_map_mode_changing
        }
        remove_global_variable = custom_map_mode
    }
    is_shown = {
        has_global_variable = custom_map_mode
        global_var:custom_map_mode = flag:minorities_map
    }
    is_valid = {
        NOT = { exists = global_var:custom_map_mode_changing }
    }
}

minority_map_icon = {
    is_shown = {
        is_county_capital = yes
        THIS.county = {
            OR = {
                county_has_small_minority_culture_trigger = yes
                county_has_large_minority_culture_trigger = yes
                county_has_small_minority_faith_trigger = yes
                county_has_large_minority_faith_trigger = yes
            }
        }
    }
}

slave_map_icon = {
    is_shown = {
        is_county_capital = yes
        THIS.county = { county_has_any_slaves_trigger = yes }
    }
}

trader_map_icon = {
    is_shown = {
        is_county_capital = yes
        THIS.county = { county_has_any_traders_trigger = yes }
    }
}

minority_management = {
    scope = character
    effect = {
        clear_variable_list = minority_counties
        remove_variable = selected_county
        remove_variable = selected_culture
        remove_variable = selected_faith
        every_held_county = {
            limit = {
                OR = {
                    county_has_minority_faith_trigger = yes
                    county_has_minority_culture_trigger = yes
                }
            }
            save_scope_as = county_with_minority
            ROOT = {
                add_to_variable_list = {
                    name = minority_counties
                    target = scope:county_with_minority
                }
            }
        }
    }
    is_shown = {
        is_ai = no
        any_sub_realm_county = {
            OR = {
                county_has_minority_faith_trigger = yes
                county_has_minority_culture_trigger = yes
            }
        }
    }
}
mysgui = {
    is_shown = {
        culture = culture:baranis
    }
}

minority_management_select_county = {
    scope = character
    saved_scopes = {
        county
    }
    effect = {
		set_variable = {
			name = selected_county
			value = scope:county
		}
    }
}

minority_management_enslave_minority_culture_small = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            remove_list_variable = {
                name = culture_minorities_small
                target = scope:culture
            }
            add_slave_culture_minority_effect = {
                CULTURE = scope:culture
                COUNTY = THIS
            }
        }
    }
}

minority_management_enslave_minority_culture_large = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            remove_list_variable = {
                name = culture_minorities_large
                target = scope:culture
            }
            add_slave_culture_minority_effect = {
                CULTURE = scope:culture
                COUNTY = THIS
            }
        }
    }
}

minority_management_enslave_minority_culture_trader = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            remove_list_variable = {
                name = culture_minorities_trader
                target = scope:culture
            }
            add_slave_culture_minority_effect = {
                CULTURE = scope:culture
                COUNTY = THIS
            }
        }
    }
}

minority_management_expel_minority_culture_small = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            add_county_modifier = {
                modifier = small_minority_expelled_modifier
                years = 10
            }
            remove_list_variable = {
                name = culture_minorities_small
                target = scope:culture
            }
        }
        scope:culture = {save_scope_as = minority_culture}
        random_neighboring_and_across_water_top_liege_realm_owner = {
            random_realm_county = {
                save_scope_as = county
                promote_culture_minority_effect = { CULTURE = scope:expelled_culture }
                scope:expelled_culture = { save_scope_as = minority_culture }
                notify_recipient_of_culture_migration_effect = yes
            }
        }
        add_gold = var:selected_county.development_level
    }
}

minority_management_expel_minority_culture_large = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            add_county_modifier = {
                modifier = large_minority_expelled_modifier
                years = 10
            }
            remove_list_variable = {
                name = culture_minorities_large
                target = scope:culture
            }
        }
        scope:culture = {save_scope_as = minority_culture}
        random_neighboring_and_across_water_top_liege_realm_owner = {
            random_realm_county = {
                save_scope_as = county
                promote_culture_minority_effect = { CULTURE = scope:expelled_culture }
                scope:expelled_culture = { save_scope_as = minority_culture }
                notify_recipient_of_culture_migration_effect = yes
            }
        }
        add_gold = {
            value = var:selected_county.development_level
            multilply = 2
        }
    }
}

minority_management_expel_minority_culture_trader = {
    scope = character
    saved_scopes = {
        culture
    }
    effect = {
        var:selected_county = {
            remove_list_variable = {
                name = culture_minorities_trader
                target = scope:culture
            }
        }
        add_tyranny = 1
        scope:culture = {save_scope_as = minority_culture}
        random_neighboring_and_across_water_top_liege_realm_owner = {
            random_realm_county = {
                save_scope_as = county
                promote_culture_minority_effect = { CULTURE = scope:expelled_culture }
                scope:expelled_culture = { save_scope_as = minority_culture }
                notify_recipient_of_culture_migration_effect = yes
            }
        }
        add_gold = {
            value = var:selected_county.development_level
            multilply = 2
        }
    }
}