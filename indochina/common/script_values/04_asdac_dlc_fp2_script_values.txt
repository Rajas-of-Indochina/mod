##################################################
# Decisions

##### Struggle Ending Decisions #####

### Common

# Counts every county in region, to check against
struggle_byzantine_ending_ending_decision_region_total_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		add = 1
	}
}

# Counts independent involved realms in Iberia, to compare
struggle_byzantine_ending_ending_decision_foreign_realm_total_value = {
	value = 0
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				NOT = { this = root }
				is_independent_ruler = yes
				primary_title = { is_mercenary_company = no }
			}
			add = 1
		}
	}
}

# Counts completely controlled de jure kingdoms of Hispania
fp2_struggle_ending_kingdom_counter_value = {
	every_held_title = {
		limit = {
			tier = tier_kingdom
			de_jure_liege = title:e_spain
			root = { completely_controls = prev }
		}
		add = 1
	}
}

### Hostility

# Parameter for conversion speed multiplier
fp2_struggle_hostility_conversion_value = 1.5

# Parameter for culture and faith opinion loss
fp2_struggle_hostility_opinion_value = 15

fp2_struggle_hostility_opinion_negative_value = -30

# Paramter for cultural acceptance loss
fp2_struggle_hostility_culture_acceptance_value = -50

fp2_struggle_hostility_culture_acceptance_large_value = -75

# Counter for de jure capital kingdom's total counties
fp2_struggle_hostility_county_total_value = {
	capital_county.de_jure_liege.de_jure_liege = {
		every_de_jure_county = { add = 1 }
	}
}

# Counter for de jure capital kingdom's same culture and faith counties
fp2_struggle_hostility_county_counter_value = {
	capital_county.de_jure_liege.de_jure_liege = {
		every_de_jure_county = {
			limit = {
				culture = root.culture
				faith = root.faith
			}
			add = 1
		}
	}
}

# Counter for other rulers who own too much of Iberia
fp2_struggle_hostility_region_counter_value = {
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				NOT = { this = root }
				is_independent_ruler = yes
				primary_title = { is_mercenary_company = no }
				any_county_in_region = {
					region = asdac_byzantine_struggle_region
					percent > fp2_struggle_hostility_region_percent_decimal_value # set by fp2_struggle_hostility_region_percent_value
					holder.top_liege = prev	
				}
			}
			add = 1
		}
	}
}

# Paramater for de jure kingdoms required
fp2_struggle_hostility_kingdom_total_value = 2

# Paramameter for percentage of Iberia that no other ruler can control
fp2_struggle_hostility_region_percent_value = 20

# Uses above to plug in to script as a decimal
fp2_struggle_hostility_region_percent_decimal_value = { 
	value = fp2_struggle_hostility_region_percent_value
	divide = 100
	max = 1
}

### Compromise 

# Counter for controlled counties in Iberia
struggle_byzantine_ending_compromise_decision_region_owned_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		limit = { holder.top_liege = root }
		add = 1
	}
}

# Percentage of Iberian counties owned
struggle_byzantine_ending_compromise_decision_region_owned_percent_value = {
	value = struggle_byzantine_ending_compromise_decision_region_owned_value
	divide = struggle_byzantine_ending_ending_decision_region_total_value
	multiply = 100
}

# Parameter for mininmum opinion
struggle_byzantine_ending_compromise_decision_opinion_value = {
	value = 60
}

# Counter for hooked and friendly rulers
struggle_byzantine_ending_compromise_decision_opinion_counter_value = {
	value = 0
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				NOT = { this = root }
				is_independent_ruler = yes
				primary_title = { is_mercenary_company = no }
				save_temporary_scope_as = this_character
				OR = {
					root = { has_strong_hook = scope:this_character }
					opinion = {
						target = root
						value >= struggle_byzantine_ending_compromise_decision_opinion_value
					}
				}
			}
			add = 1
		}
	}
}

# Counter for Iberian counties owned by non-Involved
struggle_byzantine_ending_compromise_decision_region_interloper_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		limit = {
			holder.top_liege = { asdac_character_involved_in_struggle_trigger = no }
		}
		add = 1
	}
}

# Percentage of Iberian counties owned by non-Involved
struggle_byzantine_ending_compromise_decision_region_interloper_percent_value = {
	value = struggle_byzantine_ending_compromise_decision_region_interloper_value
	divide = struggle_byzantine_ending_ending_decision_region_total_value
	multiply = 100
}

# Counter for independent king or higher Involved rulers
struggle_byzantine_ending_compromise_decision_independent_counter_value = {
	value = 0
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				NOT = { this = root }
				is_independent_ruler = yes
				primary_title = {
					is_mercenary_company = no
					tier >= tier_kingdom
				}
			}
			add = 1
		}
	}
}

# Counter for inter-Involved character wars
struggle_byzantine_ending_compromise_decision_war_counter_value = {
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				is_independent_ruler = yes
				primary_title = { is_mercenary_company = no }
				any_primary_war_enemy = {
					is_independent_ruler = yes
					any_character_struggle = {
						involvement = involved
						is_struggle_type = iberian_struggle
					}
					primary_title = { is_mercenary_company = no }
				}
			}
			add =  {
				value = 0
				if = {
					 limit = {
					 	any_character_war = {
							OR = {
								AND = {
									primary_attacker = prev
									primary_defender = {
										any_character_struggle = {
											involvement = involved
											is_struggle_type = iberian_struggle
										}
										is_independent_ruler = yes
										primary_title = { is_mercenary_company = no }
									}
								}
								AND = {
									primary_defender = prev
									primary_attacker = {
										any_character_struggle = {
											involvement = involved
											is_struggle_type = iberian_struggle
										}
										is_independent_ruler = yes
										primary_title = { is_mercenary_company = no }
									}
								}
							}
						}
					 }
					add = 0.5 # they are both primary participant so they will add 0.5 each
				}
				else = {
					add = 1 # only one of them is primary participant, so we need to add 1
				}
			}
		}
	}
}

# Paramameter for percentage of Iberia that you cannot control
fp2_struggle_compromise_owned_percent_value = 50

# Uses above to plug in to script as a decimal
fp2_struggle_compromise_owned_percent_decimal_value = { 
	value = fp2_struggle_compromise_owned_percent_value
	divide = 100
	max = 1
}

# Paramameter for percentage of Iberia that no other Involved ruler can control
fp2_struggle_compromise_involved_percent_value = 50

# Uses above to plug in to script as a decimal
fp2_struggle_compromise_involved_percent_decimal_value = { 
	value = fp2_struggle_compromise_involved_percent_value
	divide = 100
	max = 1
}

# Paramameter for percentage of Iberia that no Uninvolved ruler can control
fp2_struggle_compromise_uninvolved_percent_value = 25

# Uses above to plug in to script as a decimal
fp2_struggle_compromise_uninvolved_percent_decimal_value = { 
	value = fp2_struggle_compromise_uninvolved_percent_value
	divide = 100
	max = 1
}

### Conciliation

# Counter for allied Involved rulers 
struggle_byzantine_ending_conciliation_decision_alliance_counter_value = {
	value = 0
	struggle:iberian_struggle = {
		every_involved_ruler = {
			limit = {
				NOT = { this = root }
				is_independent_ruler = yes
				primary_title = { is_mercenary_company = no }
				is_allied_to = root
			}
			add = 1
		}
	}
}

# Parameter for num de jure kingdoms of Iberia must be owned
fp2_struggle_conciliation_kingdom_total_value = 1

# Parameter for cultural acceptance gain 
fp2_struggle_conciliation_culture_acceptance_value = 50

fp2_struggle_secure_iberian_foothold_years_value = 15

fp2_struggle_secure_iberian_foothold_faith_target_percent_value = 50

fp2_struggle_secure_iberian_foothold_faith_total_value = {
	if = {
		limit = { exists = scope:iberian_kingdom_temp }
		scope:iberian_kingdom_temp = {
			every_de_jure_county = { add = 1 }
		}
	}
	min = 1
}

fp2_struggle_secure_iberian_foothold_faith_value = {
	value = 0
	if = {
		limit = { exists = scope:iberian_kingdom_temp }
		scope:iberian_kingdom_temp = {
			every_de_jure_county = {
				limit = { faith = holder.top_liege.faith }
				add = 1
			}
		}
	}
	min = 1
}

fp2_struggle_secure_iberian_foothold_faith_percent_value = {
	value = fp2_struggle_secure_iberian_foothold_faith_value
	divide = fp2_struggle_secure_iberian_foothold_faith_total_value
	multiply = 100
}

##### Religion values #####

# Total Iberian counties of my Religion
fp2_struggle_secure_iberian_foothold_religion_total_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		limit = { religion = root.religion }
		add = 1
	}
}

# Held Iberian counties of my Religion
fp2_struggle_secure_iberian_foothold_religion_owned_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		limit = {
			religion = root.religion
			holder.top_liege = root
		}
		add = 1
	}
}

# Percentage owned Iberian counties of my Religion
fp2_struggle_secure_iberian_foothold_religion_percent_value = {
	value = fp2_struggle_secure_iberian_foothold_religion_owned_value
	divide = fp2_struggle_secure_iberian_foothold_religion_total_value
	multiply = 100
	min = 1
}

# Target percentage owned Iberia counties of my Religion
fp2_struggle_secure_iberian_foothold_religion_target_percent_value = 50

fp2_struggle_secure_iberian_foothold_religion_target_percent_decimal_value = {
	value = fp2_struggle_secure_iberian_foothold_religion_target_percent_value
	divide = 100
}

##### Outsider values #####

# Target percentage owned counties of Iberia
fp2_struggle_secure_iberian_foothold_outsider_target_percent_value = 33

fp2_struggle_secure_iberian_foothold_outsider_target_percent_decimal_value = {
	value = fp2_struggle_secure_iberian_foothold_outsider_target_percent_value
	divide = 100		
}

# Decimal target percentage owned counties of Iberia
fp2_struggle_secure_iberian_foothold_outsider_percent_decimal_value = {
	value = fp2_struggle_secure_iberian_foothold_outsider_percent_value
	divide = 100
	max = 1
}

# Percentage owned counties of Iberia
fp2_struggle_secure_iberian_foothold_outsider_percent_value = {
	value = fp2_struggle_secure_iberian_foothold_outsider_value
	divide = fp2_struggle_secure_iberian_foothold_outsider_total_value
	multiply = 100
}

fp2_struggle_secure_iberian_foothold_outsider_total_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		add = 1
	}
}

fp2_struggle_secure_iberian_foothold_outsider_value = {
	value = 0
	every_county_in_region = {
		region = asdac_byzantine_struggle_region
		limit = { holder.top_liege = root }
		add = 1
	}
}

fp2_enforce_truce_war_score_value = 25

fp2_enforce_truce_duration_value = 5

fp2_bargain_fealty_interaction_already_losing_value = 25

fp2_bargain_fealty_half_realm_size_value = {
	value = scope:recipient.realm_size
	divide = 2
}

fp2_bargain_fealty_half_max_strength_value = {
	value = scope:actor.max_military_strength
	divide = 2
}

##################################################
# Miscellaneous

# We want them to always be born in 795 or so.
fp2_lyonese_monk_age_value = {
	value = current_year
	add = -795
}

fp2_lyonese_monk_conclave_cost_value = major_piety_value

fp2_lyonese_monk_conversion_bonus_root_value = 0.5

fp2_lyonese_monk_conversion_bonus_actual_value = {
	value = court_chaplain_conversion_base_total
	multiply = fp2_lyonese_monk_conversion_bonus_root_value
}


floored_development_value = {
	value = development_level
	floor = yes
}

floored_current_development_value = {
	value = var:current_development_level
	floor = yes
}

byzantine_struggle_control_threshold = 35

byzantine_struggle_control_threshold_decimal_value = { 
	value = byzantine_struggle_control_threshold
	divide = 100
	max = 1
}