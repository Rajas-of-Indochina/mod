get_loan_for_hook_interaction = {
    category = interaction_category_diplomacy

    use_diplomatic_range = yes

    desc = get_loan_for_hook_interaction_desc

    is_shown = {
        # always = no

        scope:recipient = {
            is_ai = yes
        }

        # Must be liege, vassal, friend, family, or ally
        OR = {
            AND = {
                scope:actor = { exists = liege }
                scope:actor.liege = scope:recipient
            }
            AND = {
                scope:recipient = { exists = liege }
                scope:recipient.liege = scope:actor
            }
            scope:actor = {
                OR = {
                    has_relation_friend = scope:recipient
                    has_relation_lover = scope:recipient
                    has_relation_best_friend = scope:recipient
                    has_relation_soulmate = scope:recipient
                }
            }
            scope:actor = { is_any_family_relation_or_spouse_trigger = { CHARACTER = scope:recipient } }
            scope:actor = { is_allied_to = scope:recipient }
        }

        NOT = { scope:recipient = scope:actor }
    }

    is_valid_showing_failures_only = {
        scope:actor = {
            is_physically_able_adult = yes
            NOT = {
                is_at_war_with = scope:recipient
            }
        }
        scope:recipient = {
            is_imprisoned = no
        }
        NOR = {
            scope:recipient = { has_relation_rival = scope:actor }
            scope:recipient = { has_relation_nemesis = scope:actor }
        }
        NOT = { scope:recipient = { has_hook = scope:actor } }
        scope:recipient = {
            custom_description = {
                text = demand_payment_too_little_gold
                gold >= 1
            }
        }
    }
    on_accept = {
        scope:actor = {
            send_interface_toast = {
                title = get_loan_for_hook_interaction_message
                left_icon = scope:recipient

                scope:recipient = {
                    add_hook = { #Hook effect must match gain_hook option condition
                        target = scope:actor
                        type = favor_hook
                    }
                }
                scope:actor = {
                    if = {
                        #checks if actor has 'golden obligations' perk, get 50 instead.
                        limit = {
                            has_perk = golden_obligations_perk
                        }
                        if = {
                            limit = {
                                scope:recipient.gold >= 50
                            }
                            scope:recipient = {
                                pay_short_term_gold = {
                                    target = scope:actor
                                    gold = 50
                                }
                            }
                        }
                        else = {
                            #if not enough money
                            scope:recipient = {
                                pay_short_term_gold = {
                                    target = scope:actor
                                    gold = {
                                        value = scope:recipient.gold
                                        floor = yes
                                    }
                                }
                            }
                        }
                    }
                    else_if = {
                        limit = {
                            scope:recipient.gold >= 30
                        }
                        scope:recipient = {
                            pay_short_term_gold = {
                                target = scope:actor
                                gold = 30
                            }
                        }
                    }
                    else = {
                        #if not enough money
                        scope:recipient = {
                            pay_short_term_gold = {
                                target = scope:actor
                                gold = {
                                    value = scope:recipient.gold
                                    floor = yes
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    auto_accept = no

    ai_accept = {
        base = 0

        modifier = {
            trigger = {
                scope:recipient = { has_trait = greedy }
            }
            add = -20
        }
        modifier = {
            trigger = {
                has_trait = generous
            }
            add = 20
        }
        modifier = {
            trigger = {
                is_at_war = yes
            }
            add = -20
        }
        modifier = {
            trigger = {
                exists = scope:recipient.liege
                scope:recipient.liege = scope:actor
            }
            add = 40
        }
        modifier = {
            trigger = {
                scope:recipient.gold >= 100
            }
            desc = get_loan_for_hook_has_more_than_100_gold
            add = 40
        }
        modifier = {
            trigger = {
                scope:recipient.gold >= 50
                scope:recipient.gold < 100
            }
            desc = get_loan_for_hook_has_more_than_50_gold
            add = 20
        }
    }

    ai_potential = {
        NOT = {
            has_trait = generous
        }
        OR = {
            ai_greed >= low_positive_ai_value
            is_at_war = yes
        }
    }

    ai_target_quick_trigger = {
        adult = yes
    }

    ai_frequency = 36

    ai_will_do = {
        base = 100

        modifier = { #ai won't use the interaction if they'll get nothing out of it
            factor = 0
            scope:recipient.gold < 25
        }

        modifier = {
            factor = 0
            scope:actor = {
                OR = {
                    has_relation_friend = scope:recipient
                    has_relation_lover = scope:recipient
                    has_relation_best_friend = scope:recipient
                    has_relation_soulmate = scope:recipient
                }
            }
        }
    }
}