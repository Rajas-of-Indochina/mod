
# scope:county
# $CULTURE$
promote_culture_minority_effect = {
	if = {
		limit = { scope:county.culture = $CULTURE$ }
		# failsafe because this should never happen
	}
	else_if = {
		limit = {
			has_variable_list = culture_minorities_small
			is_target_in_variable_list = {
				name = culture_minorities_small
				target = $CULTURE$
			}
		}
		add_to_variable_list = {
			name = culture_minorities_large
			target = $CULTURE$
		}
		remove_list_variable = {
			name = culture_minorities_small
			target = $CULTURE$
		}
	}
	else_if = {
		limit = {
			has_variable_list = culture_minorities_large
			is_target_in_variable_list = {
				name = culture_minorities_large
				target = $CULTURE$
			}
		}
		remove_list_variable = {
			name = culture_minorities_large
			target = $CULTURE$
		}
		add_to_variable_list = {
			name = culture_minorities_large
			target = scope:county.culture
		}

		set_county_culture = $CULTURE$
	}
	else = {
		add_to_variable_list = {
			name = culture_minorities_small
			target = $CULTURE$
		}
	}
}

# scope:county
# $FAITH$
promote_faith_minority_effect = {
	if = {
		limit = { scope:county.faith = $FAITH$ }
		# failsafe because this should never happen
	}
	else_if = {
		limit = {
			has_variable_list = faith_minorities_small
			is_target_in_variable_list = {
				name = faith_minorities_small
				target = $FAITH$
			}
		}
		add_to_variable_list = {
			name = faith_minorities_large
			target = $FAITH$
		}
		remove_list_variable = {
			name = faith_minorities_small
			target = $FAITH$
		}
	}
	else_if = {
		limit = {
			has_variable_list = faith_minorities_large
			is_target_in_variable_list = {
				name = faith_minorities_large
				target = $FAITH$
			}
		}
		remove_list_variable = {
			name = faith_minorities_large
			target = $FAITH$
		}
		add_to_variable_list = {
			name = faith_minorities_large
			target = scope:county.faith
		}

		set_county_faith = $FAITH$
	}
	else = {
		add_to_variable_list = {
			name = faith_minorities_small
			target = $FAITH$
		}
	}
}

spawn_minority_culture_in_bordering_county_effect = {
	save_scope_as = this_culture

	random_culture_county = {
		limit = {
			# Must border a culture which is not this_culture
			any_title_to_title_neighboring_county = { NOT = { this.culture = scope:this_culture } }
		}
		save_scope_as = source_county

		random_neighboring_county = {
			limit = { NOT = { this.culture = scope:this_culture } }
			save_scope_as = county

			# promote culture minority
			promote_culture_minority_effect = { CULTURE = scope:source_county.culture }

			scope:source_county.holder = {
				add_to_temporary_list = characters_to_notify
				top_liege = {
					add_to_temporary_list = characters_to_notify
					every_vassal_or_below = {
						limit = {
							any_sub_realm_county = {
								this = scope:source_county
							}
						}
						add_to_temporary_list = characters_to_notify
					}
				}
			}

			scope:county.holder = {
				add_to_temporary_list = characters_to_notify
				top_liege = {
					add_to_temporary_list = characters_to_notify
					every_vassal_or_below = {
						limit = {
							any_sub_realm_county = {
								this = scope:county
							}
						}
						add_to_temporary_list = characters_to_notify
					}
				}
			}

			every_in_local_list = {
				list = characters_to_notify

				send_interface_toast = {
					type = event_generic_neutral
					title = minority_culture_spread_title
					custom_tooltip = minority_culture_spread_tt
					right_icon = scope:county
				}
			}
		}
	}
}

spawn_minority_faith_in_bordering_county_effect = {
	save_scope_as = this_faith

	random_county = {
		limit = {
			faith = scope:this_faith
			# Must border a faith which is not this_faith
			any_title_to_title_neighboring_county = { NOT = { this.faith = scope:this_faith } }
		}
		save_scope_as = source_county

		random_neighboring_county = {
			limit = { NOT = { this.faith = scope:this_faith } }
			save_scope_as = county

			# promote faith minority
			promote_faith_minority_effect = { FAITH = scope:source_county.faith }

			scope:source_county.holder = {
				add_to_temporary_list = characters_to_notify
				top_liege = {
					add_to_temporary_list = characters_to_notify
					every_vassal_or_below = {
						limit = {
							any_sub_realm_county = {
								this = scope:source_county
							}
						}
						add_to_temporary_list = characters_to_notify
					}
				}
			}

			scope:county.holder = {
				add_to_temporary_list = characters_to_notify
				top_liege = {
					add_to_temporary_list = characters_to_notify
					every_vassal_or_below = {
						limit = {
							any_sub_realm_county = {
								this = scope:county
							}
						}
						add_to_temporary_list = characters_to_notify
					}
				}
			}

			every_in_local_list = {
				list = characters_to_notify

				send_interface_toast = {
					type = event_generic_neutral
					title = minority_faith_spread_title
					custom_tooltip = minority_faith_spread_tt
					right_icon = scope:county
				}
			}
		}
	}
}