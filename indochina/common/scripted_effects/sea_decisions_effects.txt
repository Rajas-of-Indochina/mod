
# Override Vanilla

#####

convert_whole_realm_to_feudalism_effect = {

	## What do we convert to?

	# IF independent, take gov depending on doctrines
	# If not independent, depends on liege
		# IF liege is feudal, become feudal
		# If liege is clan, become clan
		# If liege is neither, depends on doctrines

	## Not independent, take liege's gov
	if = {
		limit = {
			is_independent_ruler = no
		}
		if = {
			limit = {
				liege = { has_government = clan_government }
			}
			change_government = clan_government
		}
		else_if = {
			limit = {
				liege = { has_government = feudal_government }
			}
			change_government = feudal_government
		}
		else_if = {
			limit = {
				liege = { has_government = mandala_government }
			}
			change_government = mandala_government
		}
		# Liege is tribal so take gov depending on faith doctrines
		else = {
			if = {
				limit = {
					faith = { has_doctrine = doctrine_right_to_rule_divine }
				}
				change_government = feudal_government
			}
			## doctrine_right_to_rule_rajadharma
			else_if = {
				limit = {
					faith = { has_doctrine = doctrine_right_to_rule_rajadharma }
				}
				change_government = mandala_government
			}
			## doctrine_right_to_rule_material
			else = {
				change_government = clan_government
			}
		}
	}
	## Independent, take gov depending on faith doctrines
	else = {
		if = {
			limit = {
				faith = { has_doctrine = doctrine_right_to_rule_divine }
			}
			change_government = feudal_government
		}
		## doctrine_right_to_rule_rajadharma
		else_if = {
			limit = {
				faith = { has_doctrine = doctrine_right_to_rule_rajadharma }
			}
			change_government = mandala_government
		}
		## doctrine_right_to_rule_material
		else = {
			change_government = clan_government
		}
	}

	##General
	#custom_tooltip = all_holding_will_change

	capital_county = {
		title_province = {
			if = {
				limit = { has_holding_type = tribal_holding }
				set_holding_type = castle_holding
				add_province_modifier = {
					modifier = converted_to_feudal_county_modifier
					years = 10
				}
			}
		}
	}


	##Sort out new laws.
	hidden_effect = {

		#Nuke tribal authorities.
		if = {
			limit = { has_realm_law = tribal_authority_0 }
			remove_realm_law = tribal_authority_0
		}
		if = {
			limit = { has_realm_law = tribal_authority_1 }
			remove_realm_law = tribal_authority_1
		}
		if = {
			limit = { has_realm_law = tribal_authority_2 }
			remove_realm_law = tribal_authority_2
		}
		if = {
			limit = { has_realm_law = tribal_authority_3 }
			remove_realm_law = tribal_authority_3
		}
		#Start off crown authorities.
		if = {
			limit = {
				has_government = mandala_government
				NOT = { has_realm_law = mandala_authority_0 }
			}
			add_realm_law_skip_effects = mandala_authority_0
		}
		else_if = {
			limit = {
				NOT = { has_realm_law = crown_authority_0 }
			}
			add_realm_law_skip_effects = crown_authority_0
		}
	}

	#VASSAL EFFECTS
	#Also convert every vassal.
	hidden_effect = {
		#Liege has taken clan, so become clan.
		if = {
			limit = {
				has_government = clan_government
			}
			every_vassal = {
				limit = { has_government = tribal_government }
				change_government = clan_government
				#Nuke tribal authorities.
				if = {
					limit = { has_realm_law = tribal_authority_0 }
					remove_realm_law = tribal_authority_0
				}
				if = {
					limit = { has_realm_law = tribal_authority_1 }
					remove_realm_law = tribal_authority_1
				}
				if = {
					limit = { has_realm_law = tribal_authority_2 }
					remove_realm_law = tribal_authority_2
				}
				if = {
					limit = { has_realm_law = tribal_authority_3 }
					remove_realm_law = tribal_authority_3
				}
				if = {
					limit = {
						NOT = { has_realm_law = crown_authority_0 }
					}
					add_realm_law_skip_effects = crown_authority_0
				}
			}
		}
		#Liege has taken mandala, so become mandala.
		if = {
			limit = {
				has_government = mandala_government
			}
			every_vassal = {
				limit = { has_government = tribal_government }
				change_government = mandala_government
				#Nuke tribal authorities.
				if = {
					limit = { has_realm_law = tribal_authority_0 }
					remove_realm_law = tribal_authority_0
				}
				if = {
					limit = { has_realm_law = tribal_authority_1 }
					remove_realm_law = tribal_authority_1
				}
				if = {
					limit = { has_realm_law = tribal_authority_2 }
					remove_realm_law = tribal_authority_2
				}
				if = {
					limit = { has_realm_law = tribal_authority_3 }
					remove_realm_law = tribal_authority_3
				}
				if = {
					limit = {
						NOT = { has_realm_law = mandala_authority_0 }
					}
					add_realm_law_skip_effects = mandala_authority_0
				}
			}
		}
		#Liege is not clan, become feudal.
		else = {
			every_vassal = {
				limit = { has_government = tribal_government }
				change_government = feudal_government
				#Nuke tribal authorities.
				if = {
					limit = { has_realm_law = tribal_authority_0 }
					remove_realm_law = tribal_authority_0
				}
				if = {
					limit = { has_realm_law = tribal_authority_1 }
					remove_realm_law = tribal_authority_1
				}
				if = {
					limit = { has_realm_law = tribal_authority_2 }
					remove_realm_law = tribal_authority_2
				}
				if = {
					limit = { has_realm_law = tribal_authority_3 }
					remove_realm_law = tribal_authority_3
				}
				if = {
					limit = {
						NOT = { has_realm_law = crown_authority_0 }
					}
					add_realm_law_skip_effects = crown_authority_0
				}
			}
		}

		every_vassal = {
			capital_county = {
				every_county_province = {
					if = {
						limit = { has_holding_type = tribal_holding }
						set_holding_type = castle_holding
						add_province_modifier = {
							modifier = converted_to_feudal_county_modifier
							years = 10
						}
					}
				}
			}
		}
	}
}

unite_circassia_decision_effect = {

    title:d_papagia = { add_to_list = circassian_kingdom }
    title:d_eudusia = { add_to_list = circassian_kingdom }
    title:d_khegayk = { add_to_list = circassian_kingdom }
    title:d_zichia = { add_to_list = circassian_kingdom }
	title:d_kassogia = { add_to_list = circassian_kingdom }

    every_in_list = {
        list = circassian_kingdom
        every_in_de_jure_hierarchy = {
            limit = {
                tier = tier_duchy
            }
            set_de_jure_liege_title = title:k_circassia
        }
    }

	title:d_eudusia = {
		set_title_name = d_zhaneqo
		set_coa = d_eudusia_zhaneqo
	}
	title:d_papagia = {
		set_title_name = d_chemguy
		set_coa = d_papagia_chemguy
	}
	title:d_kassogia = {
		set_title_name = d_besleney
		set_coa = d_kassogia_besleney
	}
	title:d_zichia = {
		set_title_name = d_ubykhia
		set_coa = d_zichia_ubykhia
	}
    hidden_effect = {
        if = {
            limit = {
				OR = {
					has_title = title:d_alania
					completely_controls = title:d_alania
					confederation = { confederation_completely_controls = { TITLE = title:d_alania } }
				}
			}
            title:d_alania = { add_to_list = circassian_kingdom }
        }
        if = {
            limit = {
				OR = {
					has_title = title:d_abkhazia
					completely_controls = title:d_abkhazia
					confederation = { confederation_completely_controls = { TITLE = title:d_abkhazia } }
				}
			}
            title:d_abkhazia = { add_to_list = circassian_kingdom }
        }
        if = {
            limit = {
				OR = {
					has_title = title:d_tmutarakan
					completely_controls = title:d_tmutarakan
					confederation = { confederation_completely_controls = { TITLE = title:d_tmutarakan } }
				}
			}
            title:d_tmutarakan = { add_to_list = circassian_kingdom }
		}
        if = {
            limit = {
				OR = {
					has_title = title:d_karabulakia
					completely_controls = title:d_karabulakia
					confederation = { confederation_completely_controls = { TITLE = title:d_karabulakia } }
				}
			}
            title:d_karabulakia = { add_to_list = circassian_kingdom }
		}

		every_in_list = {
			list = circassian_kingdom
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_duchy
				}
				set_de_jure_liege_title = title:k_circassia
			}
		}
    }
	if = {
		limit = {
			is_confederation_member = yes
		}
		hidden_effect = {
			confederation = {
				every_confederation_member = {
					add_to_list = confederation_vassals
					every_tributary = {
						limit = {
							highest_held_title_tier <= tier_duchy
						}
						add_to_list = confederation_vassals
					}
				}
			}			
			#Create the title and make it primary
			create_title_and_vassal_change = {
				type = created
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			every_in_list = {
				list = confederation_vassals
				change_liege = {
					liege = root
					change = scope:title_change
				}
			}
		}
	}
    title:k_circassia = {
        change_title_holder = {
            holder = root
            change = scope:title_change
        }
    }

    resolve_title_and_vassal_change = scope:title_change
    set_primary_title_to = title:k_circassia
}

unite_india_decision_effect = {
	#Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_india = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:e_india

	title:e_rajastan = { add_to_list = indian_empire }
	title:e_deccan = { add_to_list = indian_empire }
	title:e_dravida = { add_to_list = indian_empire }
	title:e_bengal = { add_to_list = indian_empire }

	every_in_list = {
		list = indian_empire
		every_in_de_jure_hierarchy = {
			limit = {
				tier = tier_kingdom
			}
			set_de_jure_liege_title = title:e_india
		}
	}

	hidden_effect = {
		if = {
			limit = { has_title = title:e_rajastan }
			destroy_title = title:e_rajastan
		}
		if = {
			limit = { has_title = title:e_deccan }
			destroy_title = title:e_deccan
		}
		if = {
			limit = { has_title = title:e_dravida }
			destroy_title = title:e_deccan
		}
		if = {
			limit = { has_title = title:e_bengal }
			destroy_title = title:e_bengal
		}
	}
}

#####

adopt_bureaucracy_effect = {

	##Sort out new laws.
	if = {
		limit = {
			OR = {
				has_government = tribal_government
				has_government = nomad_government
			}
		}
		capital_county = {
			every_county_province = {
				if = {
					limit = { has_holding_type = tribal_holding }
					set_holding_type = castle_holding
					add_province_modifier = {
						modifier = converted_to_feudal_county_modifier
						years = 10
					}
				}
			}
		}
		change_government = chinese_government
		#Start off crown authorities.
		if = {
			limit = {highest_held_title_tier = tier_empire}
			add_realm_law_skip_effects = bureaucratic_authority_0
		}
		else = {
			add_realm_law_skip_effects = bureaucratic_vassal_authority_0
		}
		custom_tooltip = all_holding_will_change
		hidden_effect = {
			#Nuke tribal authorities.
			if = {
				limit = { has_realm_law = tribal_authority_0 }
				remove_realm_law = tribal_authority_0
			}
			if = {
				limit = { has_realm_law = tribal_authority_1 }
				remove_realm_law = tribal_authority_1
			}
			if = {
				limit = { has_realm_law = tribal_authority_2 }
				remove_realm_law = tribal_authority_2
			}
			if = {
				limit = { has_realm_law = tribal_authority_3 }
				remove_realm_law = tribal_authority_3
			}
		}
	}
	else = {
		change_government = chinese_government
		#Start off crown authorities.
		if = {
			limit = {highest_held_title_tier = tier_empire}
			add_realm_law_skip_effects = bureaucratic_authority_0
		}
		else = {
			add_realm_law_skip_effects = bureaucratic_vassal_authority_0
		}
	}

	#VASSAL EFFECTS
	#Also convert every vassal.
	hidden_effect = {
		#Liege has taken clan, so become clan.
		every_vassal = {
			limit = {
				OR = {
					has_government = tribal_government
					has_government = nomad_government
				}
			}
			#Nuke tribal authorities.
			if = {
				limit = { has_realm_law = tribal_authority_0 }
				remove_realm_law = tribal_authority_0
			}
			if = {
				limit = { has_realm_law = tribal_authority_1 }
				remove_realm_law = tribal_authority_1
			}
			if = {
				limit = { has_realm_law = tribal_authority_2 }
				remove_realm_law = tribal_authority_2
			}
			if = {
				limit = { has_realm_law = tribal_authority_3 }
				remove_realm_law = tribal_authority_3
			}
			capital_county = {
				every_county_province = {
					if = {
						limit = { has_holding_type = tribal_holding }
						set_holding_type = castle_holding
						add_province_modifier = {
							modifier = converted_to_feudal_county_modifier
							years = 10
						}
					}
				}
			}
			change_government = chinese_government
			add_realm_law_skip_effects = bureaucratic_authority_0
		}
	}
}

#####

feudalize_into_islamic_effect = {

	change_government = clan_government

	capital_county = {
		title_province = {
			if = {
				limit = { has_holding_type = tribal_holding }
				set_holding_type = castle_holding
				add_province_modifier = {
					modifier = converted_to_feudal_county_modifier
					years = 10
				}
			}
		}
	}
	hidden_effect = {

		#Nuke tribal authorities.
		if = {
			limit = { has_realm_law = tribal_authority_0 }
			remove_realm_law = tribal_authority_0
		}
		if = {
			limit = { has_realm_law = tribal_authority_1 }
			remove_realm_law = tribal_authority_1
		}
		if = {
			limit = { has_realm_law = tribal_authority_2 }
			remove_realm_law = tribal_authority_2
		}
		if = {
			limit = { has_realm_law = tribal_authority_3 }
			remove_realm_law = tribal_authority_3
		}
		if = {
			limit = { has_realm_law = stateless_authority_0 }
			remove_realm_law = stateless_authority_0
		}
		if = {
			limit = { has_realm_law = stateless_authority_1 }
			remove_realm_law = stateless_authority_1
		}
		if = {
			limit = { has_realm_law = stateless_authority_2 }
			remove_realm_law = stateless_authority_2
		}
		if = {
			limit = { has_realm_law = stateless_authority_3 }
			remove_realm_law = stateless_authority_3
		}
		if = {
			limit = { has_realm_law = nomadic_authority_1 }
			remove_realm_law = nomadic_authority_1
		}
		if = {
			limit = { has_realm_law = nomadic_authority_2 }
			remove_realm_law = nomadic_authority_2
		}
		if = {
			limit = { has_realm_law = nomadic_authority_3 }
			remove_realm_law = nomadic_authority_3
		}
		if = {
			limit = { has_realm_law = crown_authority_0 }
			remove_realm_law = crown_authority_0
		}
		if = {
			limit = { has_realm_law = crown_authority_1 }
			remove_realm_law = crown_authority_1
		}
		if = {
			limit = { has_realm_law = crown_authority_2 }
			remove_realm_law = crown_authority_2
		}
		if = {
			limit = { has_realm_law = crown_authority_3 }
			remove_realm_law = crown_authority_3
		}
		if = {
			limit = { has_realm_law = mandala_authority_0 }
			remove_realm_law = mandala_authority_0
		}
		if = {
			limit = { has_realm_law = mandala_authority_1 }
			remove_realm_law = mandala_authority_1
		}
		if = {
			limit = { has_realm_law = mandala_authority_2 }
			remove_realm_law = mandala_authority_2
		}
		if = {
			limit = { has_realm_law = mandala_authority_3 }
			remove_realm_law = mandala_authority_3
		}
	}
	hidden_effect = {
		every_vassal = {
			feudalize_into_islamic_effect = yes
		}
	}

}

unite_nusantara_decision_effect = {
	#Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_nusantara = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:e_nusantara

	if = {
		limit = {
			OR = {
				culture = { has_cultural_pillar = heritage_filipino }
				has_title = title:e_panyupayana
				completely_controls = title:e_panyupayana
			}
		}
		title:e_panyupayana = { add_to_list = nusantara_empire }
	}

	title:e_srivijaya = { add_to_list = nusantara_empire }
	title:e_kalimantan = { add_to_list = nusantara_empire }
	title:e_sulawesi = { add_to_list = nusantara_empire }
	title:e_maluku = { add_to_list = nusantara_empire }
	title:e_java = { add_to_list = nusantara_empire }
	title:e_majapahit = { add_to_list = nusantara_empire }

	every_in_list = {
		list = nusantara_empire
		every_in_de_jure_hierarchy = {
			limit = {
				tier = tier_kingdom
			}
			set_de_jure_liege_title = title:e_nusantara
		}
	}

	hidden_effect = {
		if = {
			limit = { has_title = title:e_panyupayana }
			destroy_title = title:e_panyupayana
		}
		if = {
			limit = { has_title = title:e_srivijaya }
			destroy_title = title:e_srivijaya
		}
		if = {
			limit = { has_title = title:e_kalimantan }
			destroy_title = title:e_kalimantan
		}
		if = {
			limit = { has_title = title:e_sulawesi }
			destroy_title = title:e_sulawesi
		}
		if = {
			limit = { has_title = title:e_maluku }
			destroy_title = title:e_maluku
		}
	}
}

reform_nanyue_decision_effect = {
	#Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_nanyue = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change

	set_primary_title_to = title:e_nanyue

	if = {
		limit = {
			completely_controls = title:k_champa
		}
		title:k_champa = { set_de_jure_liege_title = title:e_nanyue }
	}
	else = {
		title:d_vijaya = { set_de_jure_liege_title = title:k_annam }
		title:d_amaravati = { set_de_jure_liege_title = title:k_annam }
		title:d_tribhuvanadevi = { set_de_jure_liege_title = title:k_annam }
	}
	title:k_annam = { set_de_jure_liege_title = title:e_nanyue }
	title:k_nanyue_china = { set_de_jure_liege_title = title:e_nanyue }

	if = {
		limit = { has_title = title:e_dai_viet }
		destroy_title = title:e_dai_viet
	}

	# Additionally give your culture a unique tradition or something
}

#####

unite_the_javanese_thrones_decision_effects = {
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_jawa = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:k_jawa
	if = {
		limit = {
			NOT = { title:k_janggala.holder = ROOT }
			exists = title:k_janggala.holder
		}
		title:k_janggala.holder = {
			add_opinion = {
				modifier = usurped_title
				target = ROOT
			}
		}
	}
	if = {
		limit = {
			NOT = { title:k_panjalu.holder = ROOT }
			exists = title:k_panjalu.holder
		}
		title:k_panjalu.holder = {
			add_opinion = {
				modifier = usurped_title
				target = ROOT
			}
		}
	}
	destroy_title = title:k_janggala
	destroy_title = title:k_panjalu
	title:k_janggala = {
		every_in_de_jure_hierarchy = {
			limit = { tier = tier_duchy }
			set_de_jure_liege_title = title:k_jawa
		}
	}
	title:k_panjalu = {
		every_in_de_jure_hierarchy = {
			limit = { tier = tier_duchy }
			set_de_jure_liege_title = title:k_jawa
		}
	}
}

form_majapahit_empire_effect = {
	every_kingdom = {
		limit = {
			OR = {
				empire = title:e_srivijaya
				empire = title:e_java
				empire = title:e_kalimantan
			}
			OR = {
				holder = ROOT
				ROOT = { completely_controls = PREV }
			}
			is_titular = no
		}
		add_to_list = majapahit_kingdoms
	}
	every_in_list = {
		list = majapahit_kingdoms
		set_de_jure_liege_title = title:e_majapahit
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_majapahit = {
		change_title_holder = {
			holder = ROOT
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change

	dynasty = {
		add_dynasty_modifier = majapahit_founder_dynn_modifier
	}
}

settle_nomadic_realm_effect = {
	#Sort out new laws
	change_government = tribal_government
	hidden_effect = {
		if = {
			limit = { has_realm_law = nomadic_authority_1 }
			remove_realm_law = nomadic_authority_1
		}
		if = {
			limit = { has_realm_law = nomadic_authority_2 }
			remove_realm_law = nomadic_authority_2
		}
		if = {
			limit = { has_realm_law = nomadic_authority_3 }
			remove_realm_law = nomadic_authority_3
		}
		add_realm_law_skip_effects = tribal_authority_0
	}

	#VASSAL EFFECTS
	#Also convert every vassal.
	hidden_effect = {
		every_vassal_or_below = {
			change_government = tribal_government
			if = {
				limit = { has_realm_law = nomadic_authority_1 }
				remove_realm_law = nomadic_authority_1
			}
			if = {
				limit = { has_realm_law = nomadic_authority_2 }
				remove_realm_law = nomadic_authority_2
			}
			if = {
				limit = { has_realm_law = nomadic_authority_3 }
				remove_realm_law = nomadic_authority_3
			}
			add_realm_law_skip_effects = tribal_authority_0
		}
	}
}

unsettle_nomadic_realm_effect = {
	#Sort out new laws
	change_government = nomad_government
	hidden_effect = {
		if = {
			limit = { has_realm_law = tribal_authority_0 }
			remove_realm_law = tribal_authority_0
		}
		if = {
			limit = { has_realm_law = tribal_authority_1 }
			remove_realm_law = tribal_authority_1
		}
		if = {
			limit = { has_realm_law = tribal_authority_2 }
			remove_realm_law = tribal_authority_2
		}
		if = {
			limit = { has_realm_law = tribal_authority_3 }
			remove_realm_law = tribal_authority_3
		}
		add_realm_law_skip_effects = nomadic_authority_1
	}

	#VASSAL EFFECTS
	#Also convert every vassal.
	hidden_effect = {
		every_vassal_or_below = {
			limit = {
				has_government = tribal_government
				culture = { has_cultural_tradition = tradition_horse_lords }
			}

			change_government = nomad_government
			hidden_effect = {
				if = {
					limit = { has_realm_law = tribal_authority_0 }
					remove_realm_law = tribal_authority_0
				}
				if = {
					limit = { has_realm_law = tribal_authority_1 }
					remove_realm_law = tribal_authority_1
				}
				if = {
					limit = { has_realm_law = tribal_authority_2 }
					remove_realm_law = tribal_authority_2
				}
				if = {
					limit = { has_realm_law = tribal_authority_3 }
					remove_realm_law = tribal_authority_3
				}
				add_realm_law_skip_effects = nomadic_authority_1
			}
		}
	}
}
reform_indo_hellenism_effect = {
	faith:indo_hellenism = {
		#Remove conversion block
		remove_variable = block_conversion_till_decision_taken
		# And you are organizing this faith
		set_variable = { name = has_been_reformed }
		remove_doctrine = unreformed_faith_doctrine
	}

	set_character_faith_with_conversion = faith:indo_hellenism
	every_realm_county = {
		limit = {
			NOT = {faith = faith:indo_hellenism }
			trigger_if = {
				limit = { faith:indo_hellenism = { has_doctrine = special_doctrine_is_buddhist_faith } }
				religion = religion:buddhism_religion
			}
			trigger_else_if = {
				limit = { faith:indo_hellenism = { has_doctrine = special_doctrine_is_hinduism_faith } }
				religion = religion:hinduism_religion
			}
			trigger_else_if = {
				limit = { faith:indo_hellenism = { has_doctrine = doctrine_spiritual_head } } # Zoroastrian
				religion = religion:zoroastrianism_religion
			}
		}
		save_scope_as = county
		add_faith_minority_effect = {
			COUNTY = scope:county
			FAITH = faith:indo_hellenism
			SIZE = small
		}
	}
}

greco_buddhism_effect = {
	faith:indo_hellenism = {
		remove_doctrine = tenet_adaptive
		add_doctrine = tenet_dharmic_pacifism
		add_doctrine = doctrine_right_to_rule_rajadharma
		add_doctrine = special_doctrine_is_buddhist_faith
	}
}

greco_hinduism_effect = {
	faith:indo_hellenism = {
		remove_doctrine = tenet_adaptive
		add_doctrine = tenet_monasticism
		add_doctrine = doctrine_right_to_rule_rajadharma
		add_doctrine = special_doctrine_is_hinduism_faith
		add_doctrine = sampradaya_vaishnavism_doctrine
	}
}

greco_zoroastrianism_effect = {
	faith:indo_hellenism = {
		remove_doctrine = doctrine_funeral_bewailment
		add_doctrine = doctrine_funeral_sky_burial
		add_doctrine = doctrine_right_to_rule_divine
		remove_doctrine = doctrine_no_head
		add_doctrine = doctrine_spiritual_head
	}
	if = {
		limit = {
			can_create_head_of_faith_title_trigger = { FAITH = faith:indo_hellenism }
		}
		faith:indo_hellenism = {
			save_scope_as = faith
		}
		create_head_of_faith_title_effect = yes
	}
}

indo_greek_flexibility = {
	faith:indo_hellenism = {
		add_doctrine = doctrine_right_to_rule_divine
		add_doctrine = tenet_unreformed_syncretism
	}
}

indo_greek_de_jure_effect = {
	title:k_sindh = {
		add_to_temporary_list = igk
	}
	title:k_punjab = {
		add_to_temporary_list = igk
	}
	title:k_kashmir = {
		add_to_temporary_list = igk
	}
	title:k_makran = {
		add_to_temporary_list = igk
	}
	title:k_kabulistan = {
		add_to_temporary_list = igk
	}

	every_in_list = {
		list = igk
		limit = {
			OR = {
				this.holder = ROOT
				ROOT = {
					completely_controls = PREV
				}
			}
		}
		set_de_jure_liege_title = title:e_indo_greek_kingdom
	}

	custom_tooltip = {
		text = indo_greek_de_jure_tt
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
	}
	title:e_indo_greek_kingdom = {
		change_title_holder = {
			holder = ROOT
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

indo_greek_culture_decision_effect = {
	set_culture = culture:indo_greek
	culture:indo_greek = {
		reset_culture_creation_date = yes
	}
	custom_tooltip = {
		text = yavana_counties_conversion_tt
		every_realm_county = {
			limit = {
				OR = {
					culture = { has_cultural_pillar = heritage_indo_aryan }
					culture = { has_cultural_pillar = heritage_byzantine }
					culture = { has_cultural_pillar = language_greek }
				}
			}
			save_scope_as = county
			random = {
				chance = 40
				set_county_culture = culture:indo_greek
				add_culture_minority_effect = {
					COUNTY = scope:county
					CULTURE = culture:indo_greek
					SIZE = small
				}
				modifier = {
					add = development_level
				}
			}
		}
	}
	custom_tooltip = {
		text = yavana_vassal_conversion_tt
		every_vassal_or_below = {
			limit = {
				is_ai = yes
				OR = {
					culture = { has_cultural_pillar = heritage_indo_aryan }
					culture = { has_cultural_pillar = heritage_byzantine }
					culture = { has_cultural_pillar = language_greek }
				}
			}
			random_list = {
				1 = {
					set_culture = culture:indo_greek
					opinion_modifier = {
						opinion_target = ROOT
						who = THIS
						multiplier = 0.1
					}
				}
				1 = {}
			}
		}
	}
}

unite_nasrani_decision_effect = {
	add_prestige = major_prestige_gain
	add_piety = major_piety_gain
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_nasrani = {
		change_title_holder = {
			holder = scope:founder
			change = scope:title_change
		}
		set_de_jure_liege_title = title:e_dravida
	}
	resolve_title_and_vassal_change = scope:title_change

	title:d_chera_nadu = { set_de_jure_liege_title = title:k_nasrani }
	title:d_konkana = { set_de_jure_liege_title = title:k_nasrani }
	if = {
		limit = {
			title:d_sinhala = { holder = root }
		}
		title:d_sinhala = { set_de_jure_liege_title = title:k_nasrani }

		struggle:RICE_sri_lanka_struggle ?= {
			set_faith_as_involved = faith:indian_catholic
		}
	}
	if = {
		limit = {
			title:d_pandya_nadu = { holder = root }
		}
		title:d_pandya_nadu = { set_de_jure_liege_title = title:k_nasrani }
	}
	every_held_title = {
		limit = {
			tier = tier_barony
			is_holy_site_of = faith:indian_catholic
		}
		county = { set_county_faith = faith:indian_catholic }
	}
	custom_tooltip = nasrani_growth_tt
	hidden_effect = {
		every_realm_county = {
			limit = {
				NOT = {
					any_in_de_jure_hierarchy = { is_holy_site_of = faith:indian_catholic }
				}
			}
			save_scope_as = county
			promote_faith_minority_effect = { FAITH = faith:indian_catholic }
		}
	}
}

unite_bene_israel_effect = {
	add_prestige = major_prestige_gain
	add_piety = major_piety_gain
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_bene_israel = {
		change_title_holder = {
			holder = scope:founder
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change

	title:d_chera_nadu = { set_de_jure_liege_title = title:k_bene_israel }
	title:d_konkana = { set_de_jure_liege_title = title:k_bene_israel }
	if = {
		limit = {
			title:d_lata = { holder = root }
		}
		title:d_lata = { set_de_jure_liege_title = title:k_bene_israel }
	}
	if = {
		limit = {
			title:d_nasikya = { holder = root }
		}
		title:d_nasikya = { set_de_jure_liege_title = title:k_bene_israel }
	}
	every_held_title = {
		limit = {
			tier = tier_barony
			is_holy_site_of = faith:malabarism
		}
		county = {
			save_scope_as = county
			culture = { save_scope_as = old_culture }
			faith = { save_scope_as = old_faith }
			set_county_culture = culture:kochinim
			set_county_faith = faith:malabarism
			add_culture_minority_effect = {
				COUNTY = scope:county
				CULTURE = scope:old_culture
				SIZE = small
			}
			add_faith_minority_effect = {
				COUNTY = scope:county
				FAITH = scope:old_faith
				SIZE = small
			}
		}
	}
	every_realm_county = {
		limit = {
			NOT = {
				any_in_de_jure_hierarchy = { is_holy_site_of = faith:malabarism }
			}
		}
		save_scope_as = county
		promote_faith_minority_effect = { FAITH = faith:malabarism }
		promote_culture_minority_effect = { CULTURE = culture:kochinim }
	}
}

form_stateless_confederation_duchy_effect = {
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}
	if = {
		# First we check if the realm county's duchy is free. If so, save that as the scope.
		limit = { NOT = { exists = capital_county.duchy.holder } }
		capital_county = { duchy = { save_scope_as = commune_title } }
		scope:commune_title = {
			change_title_holder = {
				holder = ROOT
				change = scope:change
			}
			add_title_law = anarchist_elective_succession_law
		}
	}
	else = {
		custom_tooltip = {
			text = create_commune_title_tt
			create_dynamic_title = {
				tier = duchy
				name = ANARCHIST_TITLE_NAME
			}
			scope:new_title = {
				set_destroy_on_gain_same_tier = yes
				set_no_automatic_claims = yes
				set_can_be_named_after_dynasty = no
				save_scope_as = commune_title
			}
			scope:commune_title = {
				change_title_holder = {
					holder = ROOT
					change = scope:change
				}
				add_title_law = anarchist_elective_succession_law
			}
		}
	}
	resolve_title_and_vassal_change = scope:change
	hidden_effect = {
		if = {
			limit = { scope:commune_title = { is_titular = yes } }
			scope:commune_title = {
				generate_coa = yes
				set_color_from_title = root.capital_county
			}
		}
	}
	custom_tooltip = {
		text = commune_handout_tt
		every_held_title = {
			limit = {
				tier = tier_county
				NOT = { THIS = ROOT.capital_county }
			}
			save_scope_as = title
			create_character = {
				location = scope:title.title_province
				template = generic_peasant_character
				faith = scope:title.faith
				culture = scope:title.culture
				save_scope_as = new_count
			}
			give_commune_county_effect = yes
		}
	}
}

# scope:new_count - Character to be given the county
# scope:title - the county being handed off
give_commune_county_effect = {
	create_title_and_vassal_change = {
		type = granted
		save_scope_as = change
		add_claim_on_loss = no
	}
	scope:title = {
		change_title_holder = {
			holder = scope:new_count
			change = scope:change
			take_baronies = yes
		}
	}
	resolve_title_and_vassal_change = scope:change

	hidden_effect = {
		scope:new_count = {
			change_government = anarchist_government
			add_realm_law_skip_effects = single_heir_dynasty_house
		}
	}

	# Opinion boost for new vassal
	scope:new_count = {
		add_opinion = {
			target = root
			modifier = stateless_given_county_opinion
		}
	}
}

rename_china_title_effect = {
	if = {
	    limit = { primary_title = title:k_qin_china }
	    title:e_celestia_china = {
	    	set_title_name = k_qin_china
	    	set_coa = e_qin
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_yan_china }
	    title:e_celestia_china = {
	    	set_title_name = k_yan_china
	    	set_coa = e_yan
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_zhao_china }
	    title:e_celestia_china = {
	    	set_title_name = k_zhao_china
	    	set_coa = e_zhao
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_jin_china }
	    title:e_celestia_china = {
	    	set_title_name = k_jin_china
	    	set_coa = e_later_jin
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_xia_china }
	    title:e_celestia_china = {
	    	set_title_name = k_xia_china
	    	set_coa = k_xia_china
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_shu_china }
	    title:e_celestia_china = {
	    	set_title_name = k_shu_china
	    	set_coa = e_shu
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_han_china }
	    title:e_celestia_china = {
	    	set_title_name = k_han_china
	    	set_coa = e_han
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_zhou_china }
	    title:e_celestia_china = {
	    	set_title_name = k_zhou_china
	    	set_coa = e_zhou
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_liang_china }
	    title:e_celestia_china = {
	    	set_title_name = k_liang_china
	    	set_coa = e_liang
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_qi_china }
	    title:e_celestia_china = {
	    	set_title_name = k_qi_china
	    	set_coa = e_qi
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_chu_china }
	    title:e_celestia_china = {
	    	set_title_name = k_chu_china
	    	set_coa = e_chu
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_wu_china }
	    title:e_celestia_china = {
	    	set_title_name = k_wu_china
	    	set_coa = e_wu
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_yue_china }
	    title:e_celestia_china = {
	    	set_title_name = k_yue_china
	    	set_coa = e_yue
	    }
	}
	else_if = {
	    limit = { primary_title = title:k_min_china }
	    title:e_celestia_china = {
	    	set_title_name = k_min_china
	    	set_coa = e_min
	    }
	}
	# Else pick a new name, I'm lazy to do this right now
	else = {
		# Trigger event to select another name
		# Tang, Yuan, Liao, Ba
		# Qi 齐
		# Liang 梁
		# Wu 吴
		# Chu 楚
		# Shu 蜀
		# Han 汉
		# Min 闽
		# Yue 越
		# Chen 陈
		# Song 宋
		# Wei 魏
		# Zhao 赵
		# Yan 燕
		# Jin 晋
		# Qin 秦
		# Zhou 周
		# Liang 凉
		# Dali 大理
		# Xia 夏
	}
}

malayan_sultanate_effect = {
	if = {
		limit = {
			highest_held_title_tier = tier_county
			capital_county.duchy = {
				any_de_jure_county = {
					percent >= 0.5
					holder = ROOT
				}
			}
		}
		get_title = capital_county.duchy
	}
	else_if = {
		limit = {
			highest_held_title_tier = tier_duchy
			capital_county.kingdom = {
				any_de_jure_county = {
					percent >= 0.5
					holder = ROOT
				}
			}
		}
		get_title = capital_county.kingdom
	}
	add_piety = major_piety_loss
}

form_georgia_decision_effect = {
	custom_tooltip = georgia_de_jure_tt

	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_georgia = {
		change_title_holder = {
			holder = ROOT
			change = scope:title_change
		}
	}

	if = {
		limit = {
			primary_title = title:k_abkhazia
		}
		title:k_georgia = { set_variable = k_georgia_abkhazia }
	}
	else_if = {
		limit = {
			primary_title = title:k_iberia
		}
		title:k_georgia = { set_variable = k_georgia_iberia }
	}
	else_if = {
		limit = {
			primary_title = title:k_kakheti
		}
		title:k_georgia = { set_variable = k_georgia_kakheti }
	}

	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:k_georgia

	title:k_abkhazia = { add_to_list = georgian_kingdoms }
	title:k_iberia = { add_to_list = georgian_kingdoms }
	title:k_kakheti = { add_to_list = georgian_kingdoms }

	hidden_effect = {
		every_in_list = {
			list = georgian_kingdoms
			limit = { holder = ROOT }
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_duchy
				}
				set_de_jure_liege_title = title:k_georgia
			}
			if = {
				limit = { exists = yes }
				scope:founder = {destroy_title = PREV}
			}
		}

	}
}

unify_armenian_principalities_decision_effect = {
	title:k_armenia = { add_to_list = armenian_princedoms }
	title:k_ayrarat = { add_to_list = armenian_princedoms }
	title:k_syunik = { add_to_list = armenian_princedoms }

	if = {
		limit = { NOT = { has_title = title:k_armenian_principality } }

		create_title_and_vassal_change = {
			type = created
			save_scope_as = title_change
			add_claim_on_loss = no
		}
		title:k_armenian_principality = {
			change_title_holder = {
				holder = root
				change = scope:title_change
			}
		}
		resolve_title_and_vassal_change = scope:title_change
		set_primary_title_to = title:k_armenian_principality
	}
	title:k_armenia = {
		custom_tooltip = {
			text = drift_into_principalities_tt
			every_in_de_jure_hierarchy = {
				limit = { tier = tier_duchy }
				set_de_jure_liege_title = title:k_armenian_principality
			}
			PREV = { destroy_title = title:k_armenia }
		}
	}
	title:k_ayrarat = {
		custom_tooltip = {
			text = drift_into_principalities_tt
			every_in_de_jure_hierarchy = {
				limit = { tier = tier_duchy }
				set_de_jure_liege_title = title:k_armenian_principality
			}
			PREV = { destroy_title = title:k_ayrarat }
		}
	}

	if = {
		limit = {
			OR = {
				has_title = title:k_syunik
				completely_controls = title:k_syunik
			}
		}
		title:k_syunik = {
			custom_tooltip = {
				text = drift_into_principalities_tt
				every_in_de_jure_hierarchy = {
					limit = { tier = tier_duchy }
					set_de_jure_liege_title = title:k_armenian_principality
				}
			}
			PREV = { destroy_title = title:k_syunik }
		}
	}
}

greater_abazinia_effect = {
    create_title_and_vassal_change = {
        type = created
        save_scope_as = title_change
        add_claim_on_loss = no
    }
	title:d_greater_abazinia = {
		change_title_holder = {
			holder = ROOT
			change = scope:title_change
		}
	}	
    resolve_title_and_vassal_change = scope:title_change
    set_primary_title_to = title:d_greater_abazinia
}