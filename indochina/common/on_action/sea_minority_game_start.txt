on_game_start = {
	on_actions = {
		initialize_minorities
		set_minorities_game_start
	}
}

on_game_start_after_lobby = {
    on_actions = {
        initial_spawn_minority_courtiers
    }
}

initialize_minorities = {
	effect = {
		set_global_variable = {
			name = sea_minority_is_active
			value = yes
		}
	}
}

# culture_minorities_large
# culture_minorities_small
# faith_minorities_large
# faith_minorities_small

set_minorities_game_start = {
	effect = {
		title:c_kerala = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}
		title:c_eranad = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}
		title:c_alupa = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}

		title:c_kanara = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}
		title:c_panaji = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}

		# Yazidis

		title:c_ninive = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}
		title:c_nasibin = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}
		title:c_sinjar = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}

		# Manichean

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}
		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}
		title:c_changan_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}

		# Ash'ari

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_changan_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_nanhai_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:mazdayasna
			}
		}

		title:c_pasai = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_lamuri = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}

		# Jewish

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_jerusalem = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:rabbinism
			}
		}
		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}

		# Parsees

        if = {
            limit = { game_start_date <= 1066.1.1 }

			title:c_daman = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:zurvanism
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:persian
				}
			}
		}

		## India and it's religious diversity
		#========================
		every_county = {
			limit = {
				title_province = { geographical_region = world_india }
				faith = {
					has_doctrine = eastern_hostility_doctrine
					NOT = { has_doctrine = tenet_communal_identity }
				}
			}
			this = { save_temporary_scope_as = the_county_temp }
			every_neighboring_county = {
				if = {
					limit = {
						faith = {
							has_doctrine = eastern_hostility_doctrine
							NOT = { has_doctrine = tenet_communal_identity }
							NOT = { this = scope:the_county_temp.faith }
						}
					}
					faith = { add_to_list = neighboring_faiths }
				}
			}
			every_in_list = {
				list = neighboring_faiths
				this = { save_temporary_scope_as = the_faith_temp }
				scope:the_county_temp = {
					add_to_variable_list = {
						name = faith_minorities_small
						target = scope:the_faith_temp
					}
				}
				this = { remove_from_list = neighboring_faiths }
			}
			scope:the_county_temp.holder.faith = {
				if = {
					limit = {
						has_doctrine = eastern_hostility_doctrine
						NOT = { has_doctrine = tenet_communal_identity }
						NOT = { this = scope:the_county_temp.faith }
					}
					add_to_variable_list = {
						name = faith_minorities_small
						target = scope:the_faith_temp
					}
				}
			}
		}
	}
}

initial_spawn_minority_courtiers = {
	effect = {
		every_ruler = { trigger_event = { on_action = spawn_minority_characters } }
	}
}
