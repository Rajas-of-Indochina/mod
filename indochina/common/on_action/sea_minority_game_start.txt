on_game_start = {
	on_actions = {
		initialize_minorities
		set_minorities_game_start
	}
}

on_game_start_after_lobby = {
    on_actions = {
        initial_spawn_minority_courtiers
    }
}

initialize_minorities = {
	effect = {
		set_global_variable = {
			name = sea_minority_is_active
			value = yes
		}
	}
}

# culture_minorities_large
# culture_minorities_small
# faith_minorities_large
# faith_minorities_small

set_minorities_game_start = {
	effect = {
		title:c_kerala = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}
		title:c_eranad = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}
		title:c_alupa = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}

		title:c_kanara = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}
		title:c_panaji = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}

		# Yazidis

		title:c_ninive = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}
		title:c_nasibin = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}
		title:c_sinjar = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:yazidi
			}
		}

		# Jewish

		# Middle East

		title:c_jerusalem = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:samaritan
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:radhanite
			}

			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:orthodox
			}
		}
		title:c_alexandria = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:radhanite
			}

			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:coptic
			}

		}
		title:c_byzantion = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:radhanite
			}

			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}

		# East

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}

		# Spain

		title:c_cordoba = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:sephardi
			}
		}
		title:c_sevilla = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:sephardi
			}
		}
		title:c_granada = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:sephardi
			}
		}
		title:c_toledo = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:sephardi
			}
		}
		title:c_barcelona = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:sephardi
			}
		}

		# France

		title:c_carcassonne = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:ashkenazi
			}
		}

		# Germany

		title:c_metz = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:ashkenazi
			}
		}
		title:c_speyer = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:ashkenazi
			}
		}

		# Morocco

		title:c_tangiers = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:ashkenazi
			}
		}

		# Insular Christians
		title:c_dublin = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:insular_celtic
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:irish
			}
		}

		# Egypt
		title:c_cairo = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:coptic
			}
		}

		# Baghdad
		title:c_baghdad = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:karaism
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:radhanite
			}
		}

		title:c_samarra = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:karaism
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:radhanite
			}
		}

		# Persia

		if = {
			limit = { game_start_date <= 1060.1.1 }

			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:mazdayasna
			}
		}

		title:c_isfahan = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:radhanite
			}
		}

		title:c_herat = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:radhanite
			}
		}

		title:c_kabul = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:radhanite
			}
		}

		title:c_veneto = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:samaritan
			}

			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:radhanite
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:sephardi
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:ashkenazi
			}

			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}

			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:orthodox
			}
		}

		title:c_lasta = {
			add_to_variable_list = {
				name = faith_minorities_large
				target = faith:haymanot
			}
		}


		# Parsees

        if = {
            limit = { game_start_date <= 1066.1.1 }

			title:c_daman = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:zurvanism
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:persian
				}
			}
		}

		## India and it's religious diversity
		#========================
		every_county = {
			limit = {
				title_province = { geographical_region = world_india }
				faith = {
					has_doctrine = eastern_hostility_doctrine
					NOT = { has_doctrine = tenet_communal_identity }
				}
			}
			this = { save_temporary_scope_as = the_county_temp }
			every_neighboring_county = {
				if = {
					limit = {
						faith = {
							has_doctrine = eastern_hostility_doctrine
							NOT = { has_doctrine = tenet_communal_identity }
							NOT = { this = scope:the_county_temp.faith }
						}
					}
					faith = { add_to_list = neighboring_faiths }
				}
			}
			every_in_list = {
				list = neighboring_faiths
				this = { save_temporary_scope_as = the_faith_temp }
				scope:the_county_temp = {
					add_to_variable_list = {
						name = faith_minorities_small
						target = scope:the_faith_temp
					}
				}
				this = { remove_from_list = neighboring_faiths }
			}
			scope:the_county_temp.holder.faith = {
				if = {
					limit = {
						has_doctrine = eastern_hostility_doctrine
						NOT = { has_doctrine = tenet_communal_identity }
						NOT = { this = scope:the_county_temp.faith }
					}
					add_to_variable_list = {
						name = faith_minorities_small
						target = scope:the_faith_temp
					}
				}
			}
		}

		# ROA

		if = {
            limit = { game_start_date >= 1050.1.1 }

			title:c_qianzhou_jiangxi_china = {
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:sheren
				}
			}
		}

		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}
		title:c_changan_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}

		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_changan_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_nanhai_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:mazdayasna
			}

			title:c_zhenzhou_zhuyajun_china = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:cham
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:chamic_shaivism
				}
			}
		}

		title:c_lanzhou_longxi_china = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_pasai = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}
		title:c_lamuri = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:ashari
			}
		}


        if = {
            limit = { game_start_date >= 986.1.1 }

			title:c_zhenzhou_zhuyajun_china = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:cham
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:chamic_shaivism
				}
			}
		}
	}
}

initial_spawn_minority_courtiers = {
	effect = {
		every_ruler = { trigger_event = { on_action = spawn_minority_characters } }
	}
}
