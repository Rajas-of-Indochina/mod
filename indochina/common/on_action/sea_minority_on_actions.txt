
yearly_global_pulse = {
	on_actions = {
		on_yearly_sea_minority_maintainance
		indian_struggle_minority_spread
	}
}

three_year_playable_pulse = {
	on_actions = {
		delay = { days = { 30 330 } }
		spawn_minority_characters
	}
}

on_yearly_sea_minority_maintainance = {
	effect = {
		# Normal culture/faith spread
		every_county = {
			save_scope_as = source_county
			random = {
				chance = 3
				trigger_event = {
					days = { 1 360 }
					on_action = do_culture_faith_migration
				}
			}
		}

		# Minority culture spread/growth
		every_county = {
			limit = { county_has_minority_culture_trigger = yes }

			save_scope_as = source_county
			random = {
				chance = 1
				trigger_event = {
					days = { 1 360 }
					on_action = do_minority_culture_growth
				}
			}
		}

		# Minority faith spread/growth
		every_county = {
			limit = { county_has_minority_faith_trigger = yes }

			save_scope_as = source_county
			random = {
				chance = 1
				trigger_event = {
					days = { 1 360 }
					on_action = do_minority_faith_growth
				}
			}
		}
	}
}
do_culture_faith_migration = {
	effect = {
		if = {
			limit = {
				scope:source_county = {
					NOR = {
						culture = { has_cultural_tradition = tradition_isolationist }
						faith = { has_doctrine = tenet_communal_identity }
					}
				}
			}
			county_to_county_culture_faith_migration_effect = yes
		}
	}
}
do_minority_culture_growth = {
	effect = {
		scope:source_county = {

			every_in_list = {
				variable = culture_minorities_small
				add_to_temporary_list = potential_cultures
			}
			every_in_list = {
				variable = culture_minorities_large
				add_to_temporary_list = potential_cultures
			}
			every_in_list = {
				variable = culture_minorities_large
				add_to_temporary_list = potential_cultures
			}

			random_in_list = {
				list = potential_cultures
				save_scope_as = minority_culture
				random_list = {
					50 = { minority_culture_growth_effect = yes }
					50 = { minority_culture_spread_effect = yes }
				}
			}
		}
	}
}
do_minority_faith_growth = {
	effect = {
		scope:source_county = {

			every_in_list = {
				variable = faith_minorities_small
				add_to_temporary_list = potential_faiths
			}
			every_in_list = {
				variable = faith_minorities_large
				add_to_temporary_list = potential_faiths
			}
			every_in_list = {
				variable = faith_minorities_large
				add_to_temporary_list = potential_faiths
			}

			random_in_list = {
				list = potential_faiths
				save_scope_as = minority_faith
				random_list = {
					50 = { minority_faith_growth_effect = yes }
					50 = { minority_faith_spread_effect = yes }
				}
			}
		}
	}
}

# Root is a count+ character
spawn_minority_characters = {
	trigger = {
		exists = root
		exists = root.capital_province
		any_sub_realm_county = {
			OR = {
				county_has_minority_culture_trigger = yes
				county_has_minority_faith_trigger = yes
			}
		}
	}
	effect = {
		every_courtier = {
			culture = { add_to_temporary_list = represented_cultures }
			faith = { add_to_temporary_list = represented_faiths }
		}

		every_sub_realm_county = {
			limit = {
				OR = {
					county_has_minority_culture_trigger = yes
					county_has_minority_faith_trigger = yes
				}
			}

			if = {
				limit = { county_has_minority_faith_trigger = yes }
				# get a random minority faith
				every_in_list = {
					variable = faith_minorities_small
					add_to_temporary_list = potential_faiths
				}
				every_in_list = {
					variable = faith_minorities_large
					add_to_temporary_list = potential_faiths
				}
				every_in_list = {
					variable = faith_minorities_large
					add_to_temporary_list = potential_faiths
				}

				random_in_list = {
					list = potential_faiths
					save_temporary_scope_as = faith_to_spawn
				}

				if = {
					limit = { county_has_minority_culture_trigger = yes }
					# randomly get a minority culture or the majority

					every_in_list = {
						variable = culture_minorities_small
						add_to_temporary_list = potential_cultures
					}
					every_in_list = {
						variable = culture_minorities_large
						add_to_temporary_list = potential_cultures
					}
					every_in_list = {
						variable = culture_minorities_large
						add_to_temporary_list = potential_cultures
					}
					culture = {
						add_to_temporary_list = potential_cultures
					}

					random_in_list = {
						list = potential_cultures
						save_temporary_scope_as = culture_to_spawn
					}
				}
				else = {
					# get the majority culture
					culture = { save_temporary_scope_as = culture_to_spawn }
				}
			}
			else_if = {
				limit = {
					county_has_minority_culture_trigger = yes
				}
				# get a random minority culture and the majority faith
				every_in_list = {
					variable = culture_minorities_small
					add_to_temporary_list = potential_cultures
				}
				every_in_list = {
					variable = culture_minorities_large
					add_to_temporary_list = potential_cultures
				}
				every_in_list = {
					variable = culture_minorities_large
					add_to_temporary_list = potential_cultures
				}

				random_in_list = {
					list = potential_cultures
					save_temporary_scope_as = culture_to_spawn
				}

				faith = { save_temporary_scope_as = faith_to_spawn }
			}

			if = {
				limit = {
					exists = scope:faith_to_spawn
					exists = scope:culture_to_spawn
					NAND = {
						scope:faith_to_spawn = { is_in_list = represented_faiths }
						scope:culture_to_spawn = { is_in_list = represented_cultures }
					}
				}

				create_character = {
					employer = root
					age = { 18 50 }
					gender_female_chance = 50
					random_traits = yes
					faith = scope:faith_to_spawn
					culture = scope:culture_to_spawn
				}

				scope:faith_to_spawn = { add_to_temporary_list = represented_faiths }
				scope:culture_to_spawn = { add_to_temporary_list = represented_cultures }
			}

			clear_variable_list = potential_cultures
			clear_variable_list = potential_faiths
			clear_saved_scope = faith_to_spawn
			clear_saved_scope = culture_to_spawn
		}
	}
}

# Root is an independent landed character
indian_struggle_minority_spread = {
	effect = {
		every_realm_county = {
			limit = {
				any_neighboring_county = {
					NOT = { holder.top_liege = prev.holder.top_liege } # Different realm
					NOR = {
						title_province.religion = prev.holder.top_liege.religion # Neither the owner's religion nor the county's
						title_province.religion = prev.title_province.religion
					}
					OR = {
						AND = {
							title_province.religion = religion:buddhism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_buddhist_dominance }
						}
						AND = {
							title_province.religion = religion:hinduism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_hindu_dominance }
						}
						AND = {
							title_province.religion = religion:jainism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_jain_dominance }
						}
						AND = {
							title_province.religion = religion:indian_religion
							any_county_struggle = { has_struggle_phase = struggle_india_indian_animist_dominance }
						}
						AND = {
							title_province.religion = religion:_religion
							any_county_struggle = { has_struggle_phase = struggle_india_muslim_dominance }
						}
						AND = {
							NOR = {
								title_province.religion = religion:buddhism_religion
								title_province.religion = religion:hinduism_religion
								title_province.religion = religion:jainism_religion
								title_province.religion = religion:indian_religion
								title_province.religion = religion:islam_religion
							}
							any_county_struggle = { has_struggle_phase = struggle_india_foreign_dominance }
						}
					}
				}
			}
			random_neighboring_county = {
				limit = {					
					NOT = { holder.top_liege = prev.holder.top_liege } # Different realm
					NOR = {
						title_province.religion = prev.holder.top_liege.religion # Neither the owner's religion nor the county's
						title_province.religion = prev.title_province.religion
					}
					OR = {
						AND = {
							title_province.religion = religion:buddhism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_buddhist_dominance }
						}
						AND = {
							title_province.religion = religion:hinduism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_hindu_dominance }
						}
						AND = {
							title_province.religion = religion:jainism_religion
							any_county_struggle = { has_struggle_phase = struggle_india_jain_dominance }
						}
						AND = {
							title_province.religion = religion:indian_religion
							any_county_struggle = { has_struggle_phase = struggle_india_indian_animist_dominance }
						}
						AND = {
							title_province.religion = religion:_religion
							any_county_struggle = { has_struggle_phase = struggle_india_muslim_dominance }
						}
						AND = {
							NOR = {
								title_province.religion = religion:buddhism_religion
								title_province.religion = religion:hinduism_religion
								title_province.religion = religion:jainism_religion
								title_province.religion = religion:indian_religion
								title_province.religion = religion:islam_religion
							}
							any_county_struggle = { has_struggle_phase = struggle_india_foreign_dominance }
						}
					}
				}
				save_scope_as = source_county
			}
			random_list = {
				40 = {
					trigger_event = { on_action = do_culture_faith_migration }
				}
				60 = {}
			}
		}
	}
}