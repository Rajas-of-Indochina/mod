
three_year_playable_pulse = {
	on_actions = {
		delay = { days = { 30 330 } }
		spawn_minority_characters
	}
}

on_yearly_sea_minority_maintainance = {
	effect = {
		every_culture_global = {
			limit = { NOT = { has_cultural_tradition = tradition_isolationist } }

			random = {
				chance = 3
				trigger_event = {
					days = { 1 360 }
					on_action = do_culture_migration
				}
			}
		}
		every_religion_global = {
			every_faith = {
				limit = { NOT = { has_doctrine = tenet_communal_identity } }

				random = {
					chance = 3
					trigger_event = {
						days = { 1 360 }
						on_action = do_faith_migration
					}
				}
			}
		}
	}
}

do_culture_migration = {
	effect = { spawn_minority_culture_in_bordering_county_effect = yes }
}
do_faith_migration = {
	effect = { spawn_minority_faith_in_bordering_county_effect = yes }
}

# Root is a count+ character
spawn_minority_characters = {
	trigger = {
		any_sub_realm_county = {
			OR = {
				county_has_minority_culture_trigger = yes
				county_has_minority_faith_trigger = yes
			}
		}
	}
	effect = {
		every_sub_realm_county = {
			limit = {
				OR = {
					county_has_minority_culture_trigger = yes
					county_has_minority_faith_trigger = yes
				}
			}

			if = {
				limit = {
					county_has_minority_faith_trigger = yes
				}
				# get a random minority faith
				every_in_list = {
					variable = faith_minorities_small
					add_to_temporary_list = potential_faiths
				}
				every_in_list = {
					variable = faith_minorities_large
					add_to_temporary_list = potential_faiths
				}
				every_in_list = {
					variable = faith_minorities_large
					add_to_temporary_list = potential_faiths
				}

				random_in_list = {
					list = potential_faiths
					save_temporary_scope_as = faith_to_spawn
				}

				if = {
					limit = { county_has_minority_culture_trigger = yes }
					# randomly get a minority culture or the majority

					every_in_list = {
						variable = culture_minorities_small
						add_to_temporary_list = potential_cultures
					}
					every_in_list = {
						variable = culture_minorities_large
						add_to_temporary_list = potential_cultures
					}
					every_in_list = {
						variable = culture_minorities_large
						add_to_temporary_list = potential_cultures
					}
					culture = {
						add_to_temporary_list = potential_cultures
					}

					random_in_list = {
						list = potential_cultures
						save_temporary_scope_as = culture_to_spawn
					}
				}
				else = {
					# get the majority culture
					culture = { save_temporary_scope_as = culture_to_spawn }
				}
			}
			else_if = {
				limit = {
					county_has_minority_culture_trigger = yes
				}
				# get a random minority culture and the majority faith
				every_in_list = {
					variable = culture_minorities_small
					add_to_temporary_list = potential_cultures
				}
				every_in_list = {
					variable = culture_minorities_large
					add_to_temporary_list = potential_cultures
				}
				every_in_list = {
					variable = culture_minorities_large
					add_to_temporary_list = potential_cultures
				}

				random_in_list = {
					list = potential_cultures
					save_temporary_scope_as = culture_to_spawn
				}

				faith = { save_temporary_scope_as = faith_to_spawn }
			}

			clear_variable_list = potential_cultures
			clear_variable_list = potential_faiths

			create_character = {
				employer = root
				age = { 18 50 }
				gender_female_chance = 50
				random_traits = yes
				faith = scope:faith_to_spawn
				culture = scope:culture_to_spawn
			}
		}
	}
}