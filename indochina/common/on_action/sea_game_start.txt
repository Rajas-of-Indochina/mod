# Called from code after history generation
# Empty scope
on_game_start = {
    on_actions = {
        holy_site_buildings_on_game_start
        # holy_site_descriptions_on_game_start
        add_right_to_rule_doctrines_on_game_start
        tibetan_collapse_on_game_start
    }
}

on_game_start_after_lobby = {
    on_actions = {
        ruler_popup_events
    }
}

######

# holy_site_descriptions_on_game_start = {
#     effect = {
#
#         title:b_albay = {
#             set_variable = {
#                 name = holy_site_description
#                 value = flag:holy_site_mount_mayon_description
#             }
#         }
#     }
# }

######

holy_site_buildings_on_game_start = {

    effect = {
        every_religion_global = {
            limit = {
                is_in_family = rf_animism
            }
            every_faith = {
                every_holy_site = {
                    limit = {
                        title_province = {
                            has_special_building_slot = no
                        }
                    }
                    title_province = {
                        add_special_building_slot = holy_site_pagan_grand_temple_01 # Should make a unique version of this for animists
                    }
                }
            }
        }
    }
}

######

add_right_to_rule_doctrines_on_game_start = {
    effect = {
        every_religion_global = {
            ## Christian religions except insular get Divine Right
            if = {
                limit = { this = religion:christianity_religion }
                every_faith = {
                    limit = {
                        NOR = {
                            has_doctrine = doctrine_right_to_rule_material
                            has_doctrine = doctrine_right_to_rule_divine
                        }
                    }

                    if = {
                        limit = { this = faith:insular_celtic }
                        add_doctrine = doctrine_right_to_rule_material
                    }
                    else = {
                        add_doctrine = doctrine_right_to_rule_divine
                    }
                }
            }
            ## Judaism and Zoroastrianism get Divine Right
            else_if = {
                limit = {
                    OR = {
                        this = religion:judaism_religion
                        this = religion:zoroastrianism_religion
                    }
                }
                every_faith = {
                    limit = {
                        NOR = {
                            has_doctrine = doctrine_right_to_rule_material
                            has_doctrine = doctrine_right_to_rule_divine
                        }
                    }

                    add_doctrine = doctrine_right_to_rule_divine
                }
            }
            ## Hindu, Buddhist, Jain, and Taoist get Divine Right (Will be mandala except Tao)
            else_if = {
                limit = {
                    OR = {
                        this = religion:hinduism_religion
                        this = religion:jainism_religion
                        this = religion:buddhism_religion
                        this = religion:taoism_religion
                    }
                }
                every_faith = {
                    limit = {
                        NOR = {
                            has_doctrine = doctrine_right_to_rule_material
                            has_doctrine = doctrine_right_to_rule_divine
                        }
                    }

                    add_doctrine = doctrine_right_to_rule_divine
                }
            }
            ## Everyone else gets Material Right
            else = {
                every_faith = {
                    limit = {
                        NOR = {
                            has_doctrine = doctrine_right_to_rule_material
                            has_doctrine = doctrine_right_to_rule_divine
                        }
                    }

                    add_doctrine = doctrine_right_to_rule_material
                }
            }
        }
    }
}

######

ruler_popup_events = {
    effect = {
        every_ruler = {
            if = {
                limit = { is_ai = no }
                trigger_event = {
                    id = ruler_popups.0001
                }
            }
        }
    }
}

######

tibetan_collapse_on_game_start = {
    effect = {
        if = {
            limit = { game_start_date = 867.1.1 }
        }
        title:k_u = {
            set_variable = {
                name = tibetan_empire_collapse
                value = yes
                years = 100
            }
        }
        title:k_guge = {
            set_variable = {
                name = tibetan_empire_collapse
                value = yes
                years = 100
            }
        }
    }
}