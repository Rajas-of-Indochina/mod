
#A more lenient decision to convert if your liege is feudal
convert_to_feudalism_liege_converted_decision = { #by Linnéa Thimrén
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	desc = convert_to_feudalism_liege_converted_decision_desc

	selection_tooltip = {
		first_valid = {
			triggered_desc = {
			    trigger = {
			    	faith = { has_doctrine = doctrine_right_to_rule_divine }
			    }
			    desc = convert_to_feudalism_liege_converted_decision_feudal_desc
			}
			triggered_desc = {
			    trigger = {
			    	faith = { has_doctrine = doctrine_right_to_rule_rajadharma }
			    }
			    desc = convert_to_feudalism_liege_converted_decision_mandala_desc
			}
			desc = convert_to_feudalism_liege_converted_decision_clan_desc
		}
	}

	ai_check_interval = 36

	is_shown = {
		OR = {
			has_government = tribal_government
			has_government = nomadic_government
			has_government = anarchist_government
		}
		liege = {
			OR = {
				has_government = feudal_government
				has_government = clan_government
				has_government = mandala_government
			}
		}
	}

	is_valid = {
		OR = {
			has_realm_law = tribal_authority_1
			has_realm_law = tribal_authority_2
			has_realm_law = tribal_authority_3
			has_realm_law = nomadic_authority_1
			has_realm_law = nomadic_authority_2
			has_realm_law = nomadic_authority_3
		}
		custom_description = {
			text = recent_conversion_to_tribalism
			NOT = { has_character_flag = just_converted_to_tribalism }
		}
	}

	cost = {
		prestige = 150
	}

	effect = {
		trigger_event = major_decisions.0001
		save_scope_as = actor
		convert_whole_realm_to_feudalism_effect = yes
		hidden_effect = {
			every_vassal = {
				trigger_event = {
					id = major_decisions.0002
					days = 3
				}
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

#A decision to feudalize the entire realm (wow!)
convert_whole_realm_to_feudalism_decision = { #by Linnéa Thimrén
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	desc = convert_whole_realm_to_feudalism_decision_desc

	selection_tooltip = {
		first_valid = {
			triggered_desc = {
			    trigger = {
			    	faith = { has_doctrine = doctrine_right_to_rule_divine }
			    }
			    desc = convert_whole_realm_to_feudalism_decision_feudal_tooltip
			}
			triggered_desc = {
			    trigger = {
			    	faith = { has_doctrine = doctrine_right_to_rule_rajadharma }
			    }
			    desc = convert_whole_realm_to_feudalism_decision_mandala_tooltip
			}
			desc = convert_whole_realm_to_feudalism_decision_clan_tooltip
		}
	}

	ai_check_interval = 36

	is_shown = {
		OR = {
			has_government = tribal_government
			has_government = nomadic_government
			has_government = anarchist_government
		}
		OR = {
			is_independent_ruler = yes
			AND = {
				is_independent_ruler = no
				liege = {
					NOR = {
						has_government = feudal_government
						has_government = clan_government
						has_government = mandala_government
					}
				}
			}
		}
	}

	is_valid = {
		OR = {
			has_realm_law = tribal_authority_3
			has_realm_law = nomadic_authority_3
		}
		prestige_level >= 2
		capital_province.county = {
			development_level >= convert_to_feudalism_development_requirement
		}

		custom_description = { #You need to have 70% of all (non-regional/unique) tribal innovations!
			text = has_all_tribal_innovations
			subject = root.culture
			culture = {
				calc_true_if = {
					amount >= 9
					has_innovation = innovation_motte
					has_innovation = innovation_catapult
					has_innovation = innovation_barracks
					has_innovation = innovation_mustering_grounds
					has_innovation = innovation_bannus
					has_innovation = innovation_quilted_armor
					has_innovation = innovation_gavelkind
					has_innovation = innovation_crop_rotation
					has_innovation = innovation_city_planning
					has_innovation = innovation_casus_belli
					has_innovation = innovation_plenary_assemblies
					has_innovation = innovation_ledger
					has_innovation = innovation_development_01
					has_innovation = innovation_currency_01
				}
			}
		}
	}

	cost = {
		prestige = 200
	}

	effect = {
		trigger_event = major_decisions.0001
		save_scope_as = actor
		convert_whole_realm_to_feudalism_effect = yes
		hidden_effect = {
			every_vassal = {
				trigger_event = {
					id = major_decisions.0002
					days = 3
				}
			}
		}
	}

	ai_potential = {
		NOT = { has_title = title:e_mongol_empire } #Stop the Mongols from slowing their conquest.
	}

	ai_will_do = {
		base = 100
	}
}

abandon_tributary_status_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major
	desc = abandon_tributary_status_decision_desc

	ai_check_interval = 36

	is_shown = {
		has_variable = my_suzerain
	}

	is_valid_showing_failures_only = {
		NOT = { has_truce = var:my_suzerain }
	}

	is_valid = {
		is_at_war = no

		OR = {
			custom_description = {
				text = suzerain_has_negative_prestige
				var:my_suzerain.prestige_level = 0
			}
			custom_description = {
				text = suzerain_has_lower_prestige_than_me
				var:my_suzerain.prestige_level <= {
					value = root.prestige_level
					add = -2
				}
			}
		}
	}

	effect = {
		custom_description = {
			text = stops_being_a_tributary
    	}
		var:my_suzerain = {
			add_opinion = {
	            modifier = refused_to_give_tribute_opinion
	            target = root
	        }
		}
		hidden_effect = {
		    var:my_suzerain = {
		        remove_list_variable = { name = permanent_tributaries target = prev }
		    }
		    var:my_suzerain = {
		        remove_list_variable = { name = all_tributaries target = prev }
		    }
		    var:my_suzerain = {
		        trigger_event = { id = tributaries.4 }
		    }
			remove_variable = my_suzerain
		}
	}

	ai_potential = {
		always = no
	}
}

found_angkor_wat_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_angkor_wat.dds"
	}
	decision_group_type = major
	desc = found_angkor_wat_decision_desc

	ai_check_interval = 36

	is_shown = {
		exists = capital_county
		capital_county = title:c_aninditapura
		title:c_aninditapura.title_province = {
			has_special_building_slot = no
		}
		NOT = { government_has_flag = government_is_stateless }
		culture = { has_cultural_tradition = tradition_angkorian_architecture }
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		custom_tooltip = {
			text = hindu_or_buddhist_requirement
			OR = {
				religion = religion:buddhism_religion
				religion = religion:hinduism_religion
			}
		}
	}

	is_valid = {
		custom_description = {
			text = "is_king_or_emperor"
			highest_held_title_tier >= tier_kingdom
		}
		culture = { has_innovation = innovation_windmills }
		piety_level >= 4
	}

	cost = {
		gold = 5000
		prestige = 5000
	}

	effect = {
		title:c_aninditapura = {
			title_province = {
				#set_holding_type = cow_metropolis_holding
				add_special_building_slot = angkor_wat_01
			}
		}
	}

	ai_potential = {
		always = no
	}
}

##################################################
# DE JURE DECISIONS - modified to exclude Stateless

##################################################
# Found New Kingdom
# by some unknown hero
##################################################

found_kingdom_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	}
	decision_group_type = major
	ai_check_interval = 60
	desc = found_kingdom_decision_desc

	is_shown = {
		highest_held_title_tier = tier_duchy
		NOT = { has_game_rule = off_custom_kingdoms }
		NOT = { government_has_flag = government_is_stateless }
	}

	is_valid = {
		prestige_level >= 3
		is_independent_ruler = yes
		OR = {
			custom_description = {
				text = found_kingdom_decision_three_duchies_held
				any_held_title = {
					count > 2
					tier = tier_duchy
				}
			}
			sub_realm_size >= 30
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		gold = 300
		prestige = 500
		piety = 200
	}

	effect = {
		create_custom_kingdom_effect = yes
		if = {
			limit = {
				is_ai = no
				NOT = { exists = global_var:found_kingdom_decision  }
			}
			set_global_variable = {
				name = found_kingdom_decision
				value = root
			}
			set_global_variable = {
				name = found_kingdom_decision_kingdom
				value = root.primary_title
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

##################################################
# Found New Empire
# by some unknown hero
##################################################

found_empire_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	}
	decision_group_type = major
	ai_check_interval = 60
	desc = found_empire_decision_desc

	is_shown = {
		highest_held_title_tier = tier_kingdom
		OR = {
			is_independent_ruler = yes
			any_held_title = {
				count >= 3
				tier = tier_kingdom
			}
		}
		NOT = { has_game_rule = off_custom_kingdoms }
		NOT = { government_has_flag = government_is_stateless }
	}

	is_valid = {
		prestige_level >= 4
		OR = {
			sub_realm_size >= 120
			AND = {
				custom_description = {
					text = found_empire_decision_three_kingdoms_held
					any_held_title = {
						count >= 3
						tier = tier_kingdom
					}
				}
				sub_realm_size >= 80
			}
		}

		trigger_if = {
			limit = {
				exists = struggle:iberian_struggle
				# only display the condition for people from relevant faiths and cultures
				struggle:iberian_struggle = {
					OR = {
						is_culture_involved_in_struggle = root.culture
						is_faith_involved_in_struggle = root.faith
					}
				}
				# and living nearby
				any_realm_county = {
 					title_province = {
 						OR = {
 							geographical_region = ghw_region_north_africa
 							geographical_region = world_europe_west
 							geographical_region = world_europe_south
					 	}
 					}
 				}
			}
			custom_description = {
				text = found_empire_decision_not_part_of_iberian_struggle
				NOT = {
					any_character_struggle = {
						is_struggle_type = iberian_struggle
					}
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_independent_ruler = yes
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		gold = 1200
		prestige = 2000
		piety = 600
	}

	effect = {
		create_custom_empire_effect = yes
		gain_heroic_legend_seed_tooltip_effect = yes
		hidden_effect = {
			legend_seed_new_title_effect = yes
		}
		if = {
			limit = {
				is_ai = no
				NOT = { exists = global_var:found_empire_decision  }
			}
			set_global_variable = {
				name = found_empire_decision
				value = root
			}
			set_global_variable = {
				name = found_empire_decision_empire
				value = root.primary_title
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}
