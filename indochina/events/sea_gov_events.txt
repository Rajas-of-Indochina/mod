
namespace = sea_gov_event

# Mandala vassal declares independence on succession
sea_gov_event.0001 = {
	hidden = yes

	trigger = {
		has_government = mandala_government
		any_targeting_faction = {
			faction_is_type = independence_faction
		}
	}

	immediate = {
		save_scope_as = previous_holder

		every_targeting_faction = {
			limit = { faction_is_type = independence_faction }
			every_faction_member = {
				# After a few days, declare independence via event
				save_scope_as = sender

				root.primary_heir = {
					trigger_event = {
						id = sea_gov_event.0002
						days = { 5 21 }
					}
				}
			}
		}
	}
}

# Actual notification and declaration of independence
sea_gov_event.0002 = {
    type = letter_event
    opening = {
        desc = sea_gov_event.0002.opening
    }
    desc = sea_gov_event.0002.desc
    sender = scope:sender

    option = {
    	# Vassal becomes independent and you intend to subjugate them later
        name = sea_gov_event.0002.a

		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
		}
		change_liege_or_become_independent = {
			CHANGE = scope:change
			VASSAL = scope:sender
		}
		resolve_title_and_vassal_change = scope:change

		scope:sender = {
	        add_opinion = {
	        	modifier = gained_mandala_independence_bad_opinion
	        	target = root
	        }
		}
		custom_tooltip = {
			text = gain_mandala_subjugation_cb
		}

		ai_chance = {
			base = 50
			modifier = {
				add = ai_vengefulness
			}
			modifier = {
				add = ai_boldness
			}
		}
    }
    option = {
    	# Vassal becomes independent with your blessing
        name = sea_gov_event.0002.b

		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
		}
		change_liege_or_become_independent = {
			CHANGE = scope:change
			VASSAL = scope:sender
		}
		resolve_title_and_vassal_change = scope:change

		scope:sender = {
	        add_opinion = {
	        	modifier = gained_mandala_independence_good_opinion
	        	target = root
	        }
		}

		add_truce_both_ways = {
			character = scope:sender
			days = 1825
			name = truce_mandala_independent
		}

		ai_chance = {
			base = 50
			modifier = {
				add = ai_compassion
			}
			modifier = {
				add = {
					value = 0
					subtract = ai_greed
				}
			}
		}
    }
    option = {
    	# Keep the vassal but they get a strong hook
        name = sea_gov_event.0002.c

		add_truce_both_ways = {
			character = scope:sender
			days = 1825
			name = truce_mandala_hook
		}
		scope:sender = {
			add_hook = {
				type = loyalty_hook
				target = root
			}
			add_opinion = {
				modifier = respect_opinion
				target = root
				opinion = 20
			}
		}

		ai_chance = {
			base = 50
			modifier = {
				add = ai_honor
			}
			modifier = {
				add = {
					value = 0
					subtract = ai_boldness
				}
			}
		}
    }
}

# Anarchist converts to tribalism
sea_gov_event.1000 = {
    type = character_event
	title = sea_gov_event.1000.t
	desc = sea_gov_event.1000.desc

	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		change_government = tribal_government
		add_prestige = major_prestige_value

        hidden_effect = {
			add_character_flag = {
				flag = just_converted_to_tribalism
				years = 5
			}

	    	# Remove title succession law
	    	primary_title = {
	    		remove_title_law = anarchist_elective_succession_law
	    	}

        	# Update authority
			if = {
				limit = { has_realm_law = stateless_authority_0 }
				remove_realm_law = stateless_authority_0
			}
			if = {
				limit = { has_realm_law = stateless_authority_1 }
				remove_realm_law = stateless_authority_1
			}
			if = {
				limit = { has_realm_law = stateless_authority_2 }
				remove_realm_law = stateless_authority_2
			}
			if = {
				limit = { has_realm_law = stateless_authority_3 }
				remove_realm_law = stateless_authority_3
			}
			if = {
				limit = {
					NOT = { has_realm_law = tribal_authority_0 }
				}
				add_realm_law_skip_effects = tribal_authority_0
			}

			# Convert vassals
			every_vassal_or_below = {
				limit = { has_government = anarchist_government }
				change_government = tribal_government
				if = {
					limit = { has_realm_law = stateless_authority_0 }
					remove_realm_law = stateless_authority_0
				}
				if = {
					limit = { has_realm_law = stateless_authority_1 }
					remove_realm_law = stateless_authority_1
				}
				if = {
					limit = { has_realm_law = stateless_authority_2 }
					remove_realm_law = stateless_authority_2
				}
				if = {
					limit = { has_realm_law = stateless_authority_3 }
					remove_realm_law = stateless_authority_3
				}
				if = {
					limit = {
						NOT = { has_realm_law = tribal_authority_0 }
					}
					add_realm_law_skip_effects = tribal_authority_0
				}
			}
		}
	}

    option = {
        name = sea_gov_event.1000.a
    }
}
