
namespace = maritime_southeast_asia

scripted_effect fetch_islam_options = {
	every_realm_county = {
		limit = {
			religion = religion:islam_religion
			faith = {
				NOT = { is_in_list = islam_options }
				ROOT.faith = {
					faith_hostility_level = {
						target = PREV
						value < 3
					}
				}
			}
		}
		faith = { add_to_list = islam_options }
	}
	every_realm_county = {
		limit = {
			any_in_list = {
				variable = faith_minorities_large

				religion = religion:islam_religion
				NOT = { is_in_list = islam_options }
				ROOT.faith = {
					faith_hostility_level = {
						target = PREV
						value < 3
					}
				}
			}
		}
		every_in_list = {
			variable = faith_minorities_large
			limit = {
				religion = religion:islam_religion
				NOT = { is_in_list = islam_options }
				ROOT.faith = {
					faith_hostility_level = {
						target = PREV
						value < 3
					}
				}
			}
			add_to_list = islam_options
		}
	}
	every_realm_county = {
		limit = {
			any_in_list = {
				variable = faith_minorities_small

				religion = religion:islam_religion
				NOT = { is_in_list = islam_options }
				ROOT.faith = {
					faith_hostility_level = {
						target = PREV
						value < 3
					}
				}
			}
		}
		every_in_list = {
			variable = faith_minorities_small
			limit = {
				religion = religion:islam_religion
				NOT = { is_in_list = islam_options }
				ROOT.faith = {
					faith_hostility_level = {
						target = PREV
						value < 3
					}
				}
			}
			add_to_list = islam_options
		}
	}
	every_county = {
		limit = {
			OR = {
				geographical_region = west_indian_ocean_region
				holder.top_liege = {
					has_title = title:e_celestia_china
					NOT = { religion = religion:islam_religion }
				}
				is_coastal_county = yes
			}
			OR = {
				AND = {
					religion = religion:islam_religion
					faith = {
						NOT = { is_in_list = islam_options }
						ROOT.faith = {
							faith_hostility_level = {
								target = PREV
								value < 3
							}
						}
					}
				}
				any_in_list = {
					variable = faith_minorities_large

					religion = religion:islam_religion
					NOT = { is_in_list = islam_options }
					ROOT.faith = {
						faith_hostility_level = {
							target = PREV
							value < 3
						}
					}
				}
				any_in_list = {
					variable = faith_minorities_small

					religion = religion:islam_religion
					NOT = { is_in_list = islam_options }
					ROOT.faith = {
						faith_hostility_level = {
							target = PREV
							value < 3
						}
					}
				}
			}
		}
		if = {
			limit = {
				religion = religion:islam_religion
				faith = {
					NOT = { is_in_list = islam_options }
					ROOT.faith = {
						faith_hostility_level = {
							target = PREV
							value < 3
						}
					}
				}
			}
			faith = { add_to_list = islam_options }
		}
		every_in_list = {
			variable = faith_minorities_large
			limit = {
				religion = religion:islam_religion
			}
			if = {
				limit = {NOT = { is_in_list = islam_options }}
				add_to_list = islam_options
			}
		}
		every_in_list = {
			variable = faith_minorities_small
			limit = {
				religion = religion:islam_religion
			}
			if = {
				limit = {NOT = { is_in_list = islam_options }}
				add_to_list = islam_options
			}
		}	
	}
	if = {
		limit = { list_size = { name = islam_options value >= 1 } }
		ordered_in_list = {
			list = islam_options
			position = 0
			save_scope_as = new_faith_1
		}
	}
	if = {
		limit = { list_size = { name = islam_options value >= 2 } }
		ordered_in_list = {
			list = islam_options
			position = 1
			save_scope_as = new_faith_2
		}
	}
	if = {
		limit = { list_size = { name = islam_options value >= 3 } }
		ordered_in_list = {
			list = islam_options
			position = 2
			save_scope_as = new_faith_3
		}
	}
	if = {
		limit = { list_size = { name = islam_options value >= 4 } }
		ordered_in_list = {
			list = islam_options
			position = 3
			save_scope_as = new_faith_4
		}
	}
	if = {
		limit = { list_size = { name = islam_options value >= 5 } }
		ordered_in_list = {
			list = islam_options
			position = 4
			save_scope_as = new_faith_5
		}
	}
	if = {
		limit = { list_size = { name = islam_options value >= 6 } }
		ordered_in_list = {
			list = islam_options
			position = 5
			save_scope_as = new_faith_6
		}
	}
}

scripted_effect do_islamic_settlers_effect = {
	hidden_effect = {
		every_realm_county = {
			limit = {
				county_is_religiously_protected_trigger = no
			}
			random = {
				chance = 15
				modifier = {
					add = {
						value = development_level
						multiply = {
							value = 200
							subtract = development_level
						}
						divide = 125
					}
				}
				save_scope_as = county
				promote_faith_minority_effect = { FAITH = $FAITH$ }
				if = {
					limit = {
						any_in_list = {
							variable = faith_minorities_small
							THIS = $FAITH$
						}
					}
					add_county_modifier = {
						modifier = muslim_settlers_modifier_small
						years = 5
					}
				}
				else_if = {
					limit = {
						any_in_list = {
							variable = faith_minorities_large
							THIS = $FAITH$
						}
					}
					add_county_modifier = {
						modifier = muslim_settlers_modifier_large
						years = 5
					}
				}
				if = {
					limit = {
						faith = $FAITH$
					}
					add_county_modifier = {
						modifier = muslim_settlers_modifier_majority
						years = 5
					}
				}
			}
		}
	}
	custom_tooltip = invite_muslim_settler_effect_tt
}

### Copied from Unite Africa
# maritime_southeast_asia.0001
###


################

# I united Nusantara
maritime_southeast_asia.0001 = {
	type = character_event
	title = maritime_southeast_asia.0001.t
	desc = maritime_southeast_asia.0001.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		unite_nusantara_decision_effect = yes
	}

	option = {
		name = maritime_southeast_asia.0001.a
		add_prestige = massive_prestige_value
		add_prestige_level = 2
	}
}

# I have restored the Javanese throne!
maritime_southeast_asia.0002 = {
	type = character_event
	title = maritime_southeast_asia.0002.t
	desc = maritime_southeast_asia.0002.desc
	theme = realm
	left_portrait = {
		character = scope:javanese_uniter
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_positive_effect"
		unite_the_javanese_thrones_decision_effects = yes
	}

	option = {
		name = maritime_southeast_asia.0002.a

		add_prestige_level = 2
	}
}

# I united Nanyue
# This doesn't belong in maritime but I'm lazy
maritime_southeast_asia.0003 = {
	type = character_event
	title = maritime_southeast_asia.0003.t
	desc = maritime_southeast_asia.0003.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		reform_nanyue_decision_effect = yes
		add_prestige = massive_prestige_value
		add_prestige_level = 2
	}

	option = {
		trigger = {
			culture = {
				OR = {
					has_cultural_pillar = heritage_chinese
					has_cultural_pillar = heritage_tai
				}
			}
		}
		# Create Han/Tai hybrid (Yue)
		name = maritime_southeast_asia.0003.a
		if = {
			# For Chinese cultures merging with Tai
			limit = { culture = { has_cultural_pillar = heritage_chinese } }
			create_hybrid_culture = culture:tai
			scope:new_culture = {
				hidden_effect = { set_culture_pillar = heritage_chinese }
				if = {
					limit = { NOT = { has_cultural_tradition = tradition_confucian_philosophy } }
					add_culture_tradition = tradition_confucian_philosophy
				}
				set_culture_pillar = language_chinese
			}
		}
		else_if = {
			# For Tai cultures merging with Han
			limit = { culture = { has_cultural_pillar = heritage_tai } }
			create_hybrid_culture = culture:han
			scope:new_culture = {
				hidden_effect = { set_culture_pillar = heritage_tai }
				if = {
					limit = { NOT = { has_cultural_tradition = tradition_sinicized_culture } }
					add_culture_tradition = tradition_sinicized_culture
				}
				set_culture_pillar = language_chinese
			}
		}
	}

	option = {
		# For non-Chinese, non-Tai East Asian cultures
		trigger = {
			culture = {
				NOR = {
					has_cultural_pillar = heritage_chinese
					has_cultural_pillar = heritage_tai
				}
				has_cultural_parameter = heritage_family_east_asian
			}
		}
		name = maritime_southeast_asia.0003.a
		create_hybrid_culture = culture:han
		scope:new_culture = {
			if = {
				limit = { NOT = { has_cultural_tradition = tradition_sinicized_culture } }
				add_culture_tradition = tradition_sinicized_culture
			}
			set_culture_pillar = language_chinese
		}
	}

	option = {
		# For everyone else (I see you beelining for China as Haesteinn)
		trigger = {
			culture = { NOT = { has_cultural_parameter = heritage_family_east_asian } }
		}
		name = maritime_southeast_asia.0003.a
		create_divergent_culture = yes
		scope:new_culture = {
			random_list = {
				1 = { set_culture_pillar = ethos_courtly }
				1 = { set_culture_pillar = ethos_communal }
				1 = { set_culture_pillar = ethos_bureaucratic }
			}
			set_culture_pillar = language_chinese
			if = {
				limit = { NOT = { has_cultural_tradition = tradition_sinicized_culture } }
				add_culture_tradition = tradition_sinicized_culture
			}
		}
	}
}

# I embraced Tagalog
maritime_southeast_asia.0004 = {
	type = character_event
	title = maritime_southeast_asia.0004.t
	desc = maritime_southeast_asia.0004.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
	}

	option = {
		name = maritime_southeast_asia.0004.a
		custom_tooltip = maritime_southeast_asia.0004.tooltip
	}
}

# Choose a tradition for Tagalog
maritime_southeast_asia.0005 = {
	type = character_event
	title = maritime_southeast_asia.0005.t
	desc = maritime_southeast_asia.0005.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = maritime_southeast_asia.0005.a
		culture:tagalog = { add_culture_tradition = tradition_seafaring }
		custom_tooltip = maritime_southeast_asia.0005.tooltipa
	}
	option = {
		name = maritime_southeast_asia.0005.b
		culture:tagalog = { add_culture_tradition = tradition_artisans }
		custom_tooltip = maritime_southeast_asia.0005.tooltipb
	}
	option = {
		name = maritime_southeast_asia.0005.c
		culture:tagalog = { add_culture_tradition = tradition_xenophilic }
		custom_tooltip = maritime_southeast_asia.0005.tooltipc
	}
	option = {
		name = maritime_southeast_asia.0005.d
		culture:tagalog = { add_culture_tradition = tradition_mystical_ancestors }
		custom_tooltip = maritime_southeast_asia.0005.tooltipd
	}
	option = {
		name = maritime_southeast_asia.0005.e
		add_prestige = massive_prestige_value
		custom_tooltip = maritime_southeast_asia.0005.tooltipe
	}
}

# If your capital county got settled by Tagalogs, choose what to do with them
maritime_southeast_asia.0006 = {
	type = character_event
	title = maritime_southeast_asia.0006.t
	desc = maritime_southeast_asia.0006.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = { # Leave the Tagalogs be
		name = maritime_southeast_asia.0006.a
		custom_tooltip = maritime_southeast_asia.0006.tooltipa
	}
	option = { # No Tagalogs allowed
		name = maritime_southeast_asia.0006.b
		capital_county = {
			set_county_culture = root.culture
			remove_county_modifier = tagalog_migration_modifier
			add_county_modifier = {
				modifier = tagalog_migrants_denied_entry_modifier
				years = 20
				desc = tagalog_migrants_denied_entry_modifier_desc
			}
		}
	}
	option = { # Convert to Tagalog culture
		name = maritime_southeast_asia.0006.c
		set_culture = culture:tagalog
	}
}

#I have formed the Majapahit empire!
maritime_southeast_asia.0007 = {
	type = character_event
	title = maritime_southeast_asia.0007.t
	desc = maritime_southeast_asia.0007.desc
	theme = realm
	left_portrait = {
		character = scope:majapahit_emperor
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_positive_effect"
		form_majapahit_empire_effect = yes
		#show_as_tooltip = { form_majapahit_empire_effect = yes }
	}

	option = {
		name = maritime_southeast_asia.0007.a

		add_prestige_level = 2
	}
}

# I am inviting Islamic settlers.
maritime_southeast_asia.0008 = {
	type = character_event
	title = maritime_southeast_asia.0008.t
	desc = maritime_southeast_asia.0008.desc
	theme = diplomacy_foreign_affairs_focus
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		fetch_islam_options = yes
	}

	option = {
		trigger = { exists = scope:new_faith_1 }
		name = maritime_southeast_asia.0008.a
		do_islamic_settlers_effect = { FAITH = scope:new_faith_1 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		trigger = { exists = scope:new_faith_2 }
		name = maritime_southeast_asia.0008.b
		do_islamic_settlers_effect = { FAITH = scope:new_faith_2 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		trigger = { exists = scope:new_faith_3 }
		name = maritime_southeast_asia.0008.c
		do_islamic_settlers_effect = { FAITH = scope:new_faith_3 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		trigger = { exists = scope:new_faith_4 }
		name = maritime_southeast_asia.0008.d
		do_islamic_settlers_effect = { FAITH = scope:new_faith_4 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		trigger = { exists = scope:new_faith_5 }
		name = maritime_southeast_asia.0008.e
		do_islamic_settlers_effect = { FAITH = scope:new_faith_5 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		trigger = { exists = scope:new_faith_6 }
		name = maritime_southeast_asia.0008.f
		do_islamic_settlers_effect = { FAITH = scope:new_faith_6 }
		add_piety = major_piety_loss
		if = {
			limit = {
				culture = {
					has_cultural_era_or_later = culture_era_late_medieval
				}
			}
			add_gold = {
				value = major_gold_value
				multiply = -1
			}
		}
		else = {
			add_gold = {
				value = massive_gold_value
				multiply = -1
			}
		}
	}

	option = {
		name = maritime_southeast_asia.0008.nevermind
		remove_decision_cooldown = invite_islamic_settlers_decision
	}

}