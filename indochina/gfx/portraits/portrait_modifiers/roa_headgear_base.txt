# Tags:
# rank_headgear: any headgear that signifies a certain title. crowns, pope hat etc.

# Valid culture inputs

# CULTURE_INPUT = dde_abbasid
# CULTURE_INPUT = dde_hre
# CULTURE_INPUT = byzantine
# CULTURE_INPUT = indian
# CULTURE_INPUT = mena
# CULTURE_INPUT = northern
# CULTURE_INPUT = western
# CULTURE_INPUT = western_era1
# CULTURE_INPUT = western_era2
# CULTURE_INPUT = western_era3
# CULTURE_INPUT = western_era4
# CULTURE_INPUT = steppe
# CULTURE_INPUT = fp1_norse
# CULTURE_INPUT = fp2_iberian_christian
# CULTURE_INPUT = fp2_iberian_muslim

roa_headgear_base = {

	usage = game
	selection_behavior = weighted_random
	priority = 1


	#######################
	###   Han Chinese   ###
	#######################

	chinese_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
				has_trait = peasant_leader
				OR = {
					is_ruler = no
					is_leading_faction_type = peasant_faction
					AND = {
						is_ruler = yes
						is_landed = no
						OR = {
							has_government = feudal_government
							has_government = chinese_government
							has_government = clan_government
						}
					}
				}
				portrait_chinese_clothing_trigger = yes
			}
			modifier = {
				add = 50
				highest_held_title_tier < tier_county
				NOR = {
					AND = {
						exists = primary_spouse
						primary_spouse = {
						highest_held_title_tier > tier_county
						}
					}
					has_government = republic_government
					AND = { is_ruler = yes has_government = theocracy_government }
				}
				portrait_chinese_clothing_trigger = yes
			}
		}
	}

	chinese_mayors = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 60
				highest_held_title_tier < tier_county
				has_government = republic_government
				portrait_chinese_clothing_trigger = yes
			}
		}
	}

	chinese_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				NOT = { has_government = theocracy_government }
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								has_government = feudal_government
								has_government = chinese_government
								has_government = clan_government
							}
						}
					}
				}
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				OR = {
					AND = {
						highest_held_title_tier = tier_county
						NOT = {
						AND = { is_ruler = yes has_government = theocracy_government }
						}
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							highest_held_title_tier = tier_county
							NOT = {
							AND = { is_ruler = yes has_government = theocracy_government }
							}
						}
					}
				}

			}
		}
	}

	chinese_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				NOT = { has_government = theocracy_government }
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								has_government = feudal_government
								has_government = chinese_government
								has_government = clan_government
							}
						}
					}
				}
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_duchy
							AND = { is_ruler = yes has_government = theocracy_government }
						}
						NOT = { AND = { is_ruler = yes has_government = mercenary_government  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_duchy
								AND = { is_ruler = yes has_government = theocracy_government }
							}
						}
					}
				}

			}
		}
	}

	chinese_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
				NOT = { has_government = theocracy_government }
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								has_government = feudal_government
								has_government = chinese_government
								has_government = clan_government
							}
						}
					}
				}
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_kingdom
							AND = { is_ruler = yes has_government = theocracy_government }
						}
						NOT = { AND = { is_ruler = yes has_government = mercenary_government  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_kingdom
								AND = { is_ruler = yes has_government = theocracy_government }
							}
							NOT = { AND = { is_ruler = yes has_government = mercenary_government  } } # Blocked for mercenaries
						}
					}
				}
			}
		}
	}

	chinese_princes = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_prince
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				any_parent = { highest_held_title_tier = tier_empire }
				portrait_chinese_clothing_trigger = yes
			}
		}
	}

	chinese_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 110
				OR = {
					highest_held_title_tier = tier_empire
					AND = {
						exists = primary_spouse
						is_female = yes
						primary_spouse = { highest_held_title_tier = tier_empire }
					}
				}
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								has_government = feudal_government
								has_government = chinese_government
								has_government = clan_government
							}
						}
					}
				}
				NOR = {
					AND = { is_ruler = yes has_government = mercenary_government  }
					has_government = republic_government
					AND = { is_ruler = yes has_government = theocracy_government }
				}
				portrait_chinese_wear_helmet_trigger = no
				OR = {
					has_primary_title = title:e_celestia_china
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
			}
		}
	}

	chinese_song_headgear = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_song_headgear
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = -30
			modifier = {
				add = 30
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								has_government = feudal_government
								has_government = clan_government
							}
						}
					}
				}
				portrait_chinese_clothing_trigger = yes
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_duchy
							AND = { is_ruler = yes has_government = theocracy_government }
						}
						NOT = { AND = { is_ruler = yes has_government = mercenary_government  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_duchy
								AND = { is_ruler = yes has_government = theocracy_government }
							}
						}
					}
				}
			}
			modifier = {
				add = 170
				NOT = { portrait_era1_trigger = yes } #current_date >= 960.1.1
				exists = this
				is_adult = yes
				OR = {
					has_government = chinese_government
					AND = {
				        exists = liege
				        liege = {
							AND = {
								has_title = title:e_celestia_china
								has_government = chinese_government
							}
				        }
				    }
				}
				portrait_chinese_wear_helmet_trigger = no
			}
			modifier = {
				add = -180
				exists = this
				NOT = { has_government = chinese_government }
			}
		}
	}


	#######################
	###    Shogunate    ###
	#######################

	shogunate_no_headgear = {

		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = no_headgear
				range = { 0 1 } # For the randomness to work correctly
			}
		}

		weight = {
			base = 0
			# No headgear for Japanese characters
			modifier = {
				add = 50
				OR = {
					portrait_yamato_clothing_trigger = yes
					portrait_ryukyu_clothing_trigger = yes
					portrait_ainu_clothing_trigger = yes
				}
			}
			modifier = {
				add = 50
				portrait_japanese_wear_armor_trigger = yes
			}
		}
	}

	shogunate_japanese_suieikan = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = shogunate_suieikan
				range = { 0 1 }
			}
		}

		weight = {
			base = 0
			modifier = {
				add = 50
				AND = {
					OR = {
						AND = {
							highest_held_title_tier >= tier_duchy
							OR = {
								has_government = feudal_government
								has_government = chinese_government
							}
						}
						has_title = title:d_tenno
						AND = {
							exists = court_owner
							court_owner = {
								highest_held_title_tier >= tier_kingdom
								#culture = { has_cultural_pillar = heritage_imperial_court }
							}
						}
						#culture = { has_cultural_pillar = heritage_imperial_court }
					}
					scope:age >= 16
					NOT = { portrait_wear_armor_trigger = yes }
					portrait_yamato_clothing_trigger = yes
				}
			}
			modifier = {
				add = 50
				AND = {
					scope:age >= 16
					shogunate_should_be_no_hair_trigger = no
					portrait_yamato_clothing_trigger = yes
				}
			}
		}
	}


	#######################
	###  Rajas of Asia  ###
	#######################

	roa_khmer_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = khmer_crown
				range = { 0 1 }
			}
		}

		weight = {
			base = 0
			modifier = {
				add = 100
				AND = {
					OR = {
						AND = {
							highest_held_title_tier >= tier_kingdom
						}
						AND = {
							highest_held_title_tier >= tier_duchy
							is_independent_ruler = yes
						}
						AND = {
							exists = court_owner
							court_owner = {
								highest_held_title_tier >= tier_kingdom
							}
						}
					}
					scope:age >= 16
					NOT = { portrait_wear_armor_trigger = yes }
					portrait_khmer_clothing_trigger = yes
				}
			}
			modifier = {
				add = 100
				AND = {
					scope:age >= 16
					portrait_khmer_clothing_trigger = yes
				}
			}
		}
	}

	roa_tai_no_headgear = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template =  no_headgear
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = { # Tai duchy and below got no helmet
				add = 55
				exists = this
				highest_held_title_tier <= tier_duchy
				NOR = {
					AND = {
						exists = primary_spouse
						primary_spouse = {
							highest_held_title_tier > tier_duchy
						}
					}
					AND = {
						has_government = republic_government
						primary_title.tier > 1
					}
					AND = { is_ruler = yes has_government = theocracy_government }
				}
				portrait_tai_clothing_spouse_trigger = yes
			}
			modifier = { # Tai kids shouldn't wear mongkuts
				add = 60
				AND = {
					scope:age < 16
					portrait_tai_clothing_trigger = yes
				}
			}
		}
	}

	roa_tai_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = tai_crown
				range = { 0 1 }
			}
		}

		weight = {
			base = 0
			modifier = {
				add = 200
				AND = {
					OR = {
						AND = {
							highest_held_title_tier >= tier_kingdom
						}
						AND = {
							highest_held_title_tier >= tier_duchy
							is_independent_ruler = yes
						}
						AND = {
							exists = court_owner
							court_owner = {
								highest_held_title_tier >= tier_kingdom
							}
						}
					}
					scope:age >= 16
					NOT = { portrait_wear_armor_trigger = yes }
					portrait_tai_clothing_trigger = yes
				}
			}
			modifier = {
				add = 200
				AND = {
					scope:age >= 16
					portrait_tai_clothing_trigger = yes
				}
			}
		}
	}

}
